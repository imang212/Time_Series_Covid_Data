<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.5.57">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Patrik Poklop, Tomáš Ladislav Kotek">

<title>Analýza covid dat</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="covid_data_analyse_files/libs/clipboard/clipboard.min.js"></script>
<script src="covid_data_analyse_files/libs/quarto-html/quarto.js"></script>
<script src="covid_data_analyse_files/libs/quarto-html/popper.min.js"></script>
<script src="covid_data_analyse_files/libs/quarto-html/tippy.umd.min.js"></script>
<script src="covid_data_analyse_files/libs/quarto-html/anchor.min.js"></script>
<link href="covid_data_analyse_files/libs/quarto-html/tippy.css" rel="stylesheet">
<link href="covid_data_analyse_files/libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="covid_data_analyse_files/libs/bootstrap/bootstrap.min.js"></script>
<link href="covid_data_analyse_files/libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="covid_data_analyse_files/libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">


</head>

<body class="fullcontent">

<div id="quarto-content" class="page-columns page-rows-contents page-layout-article">

<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Analýza covid dat</h1>
</div>



<div class="quarto-title-meta">

    <div>
    <div class="quarto-title-meta-heading">Author</div>
    <div class="quarto-title-meta-contents">
             <p>Patrik Poklop, Tomáš Ladislav Kotek </p>
          </div>
  </div>
    
  
    
  </div>
  


</header>


<style>
#quarto-content {
  display: flex;
  align-content: center;
}
main {
  max-width: 1000px;
  margin-left: auto;
  margin-right: auto;
}
</style>
<section id="analýza-covid-dat-na-časové-řady" class="level1">
<h1>Analýza covid dat na časové řady</h1>
<section id="úvod" class="level2">
<h2 class="anchored" data-anchor-id="úvod">Úvod</h2>
<p>V této analýze se zaměřujem na hledání optimálního modelu pro časovou řadu COVID-19 dat od 5.1.2020 do 8.4.2024. Cílem je otestovat různé přístupy k modelování časových řad a najít ten, který nejlépe popisuje data a poskytuje nejpřesnější predikce.</p>
<p>Analýza postupu je systematicky přes několik kroků: Explorativní analýza - grafické zobrazení a identifikace základních charakteristik:</p>
<ul>
<li><p>Dekompozice - rozdělení řady na trend, sezónní a náhodnou složku</p></li>
<li><p>Funkční modelování - hledání matematické funkce popisující trend a sezónnost</p></li>
<li><p>SARIMA modelování - autoregresní přístup zachycující časovou závislost</p></li>
<li><p>Multivariátní modelování - zahrnutí vlivu ostatních proměnných</p></li>
<li><p>Srovnání a validace - výběr nejlepšího modelu na základě kritérií</p></li>
</ul>
<p>Jako hlavní řadu jsme zvolili new_cases(nové případy COVID-19), protože:</p>
<ul>
<li><p>Má výrazný dlouhodobý trend (růst během pandemie).</p></li>
<li><p>Vykazuje sezónní chování (vyšší hodnoty v zimních měsících).</p></li>
<li><p>Je klíčovou metrikou pro epidemiologické sledování.</p></li>
<li><p>Má dostupná kvalitní data bez příliš mnoha chybějících hodnot.</p></li>
</ul>
</section>
<section id="převod-dat-na-časovou-řadu" class="level2">
<h2 class="anchored" data-anchor-id="převod-dat-na-časovou-řadu">Převod dat na časovou řadu</h2>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Převod datumu na správný formát</span></span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a>data<span class="sc">$</span>date <span class="ot">&lt;-</span> <span class="fu">as.Date</span>(data<span class="sc">$</span>date)</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Kontrola chybějících hodnot v new_cases</span></span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"</span><span class="sc">\n</span><span class="st">Chybějící hodnoty v new_cases:</span><span class="sc">\n</span><span class="st">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Chybějící hodnoty v new_cases:</code></pre>
</div>
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a>missing_summary <span class="ot">&lt;-</span> <span class="fu">sapply</span>(data<span class="sc">$</span>new_cases, <span class="cf">function</span>(x) <span class="fu">sum</span>(<span class="fu">is.na</span>(x)))</span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(<span class="fu">head</span>(missing_summary[missing_summary <span class="sc">&gt;</span> <span class="dv">0</span>]))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 1 1 1 1 1 1</code></pre>
</div>
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"</span><span class="sc">\n</span><span class="st">Chybějící hodnoty v dates:</span><span class="sc">\n</span><span class="st">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Chybějící hodnoty v dates:</code></pre>
</div>
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a>missing_summary <span class="ot">&lt;-</span> <span class="fu">sapply</span>(data<span class="sc">$</span>date, <span class="cf">function</span>(x) <span class="fu">sum</span>(<span class="fu">is.na</span>(x)))</span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(<span class="fu">head</span>(missing_summary[missing_summary <span class="sc">&gt;</span> <span class="dv">0</span>]))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>integer(0)</code></pre>
</div>
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Kontrola new_cases sloupce</span></span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"</span><span class="sc">\n</span><span class="st">Souhrn new_cases sloupce:</span><span class="sc">\n</span><span class="st">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Souhrn new_cases sloupce:</code></pre>
</div>
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(<span class="fu">summary</span>(data<span class="sc">$</span>new_cases))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>    Min.  1st Qu.   Median     Mean  3rd Qu.     Max.     NA's 
       0        0        0     8496        0 44236227    18431 </code></pre>
</div>
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Odstranění řádků s chybějícími hodnotami v new_cases</span></span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a>original_rows <span class="ot">&lt;-</span> <span class="fu">nrow</span>(data)</span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a>data <span class="ot">&lt;-</span> data[<span class="sc">!</span><span class="fu">is.na</span>(data<span class="sc">$</span>new_cases), ]</span>
<span id="cb13-4"><a href="#cb13-4" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"</span><span class="sc">\n</span><span class="st">Odstraněno"</span>, original_rows <span class="sc">-</span> <span class="fu">nrow</span>(data), <span class="st">"řádků s chybějícími hodnotami v new_cases</span><span class="sc">\n</span><span class="st">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Odstraněno 18431 řádků s chybějícími hodnotami v new_cases</code></pre>
</div>
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Vytvoření měsíc-rok proměnné</span></span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a>data<span class="sc">$</span>year_month <span class="ot">&lt;-</span> <span class="fu">format</span>(data<span class="sc">$</span>date, <span class="st">"%Y-%m"</span>)</span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a>data<span class="sc">$</span>year <span class="ot">&lt;-</span> <span class="fu">as.numeric</span>(<span class="fu">format</span>(data<span class="sc">$</span>date, <span class="st">"%Y"</span>))</span>
<span id="cb15-4"><a href="#cb15-4" aria-hidden="true" tabindex="-1"></a>data<span class="sc">$</span>month <span class="ot">&lt;-</span> <span class="fu">as.numeric</span>(<span class="fu">format</span>(data<span class="sc">$</span>date, <span class="st">"%m"</span>))</span>
<span id="cb15-5"><a href="#cb15-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-6"><a href="#cb15-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Agregace na měsíční součty</span></span>
<span id="cb15-7"><a href="#cb15-7" aria-hidden="true" tabindex="-1"></a>monthly_data <span class="ot">&lt;-</span> data <span class="sc">%&gt;%</span></span>
<span id="cb15-8"><a href="#cb15-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(year, month, year_month) <span class="sc">%&gt;%</span></span>
<span id="cb15-9"><a href="#cb15-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(</span>
<span id="cb15-10"><a href="#cb15-10" aria-hidden="true" tabindex="-1"></a>    <span class="at">new_cases =</span> <span class="fu">sum</span>(new_cases, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb15-11"><a href="#cb15-11" aria-hidden="true" tabindex="-1"></a>    <span class="at">new_deaths =</span> <span class="fu">sum</span>(new_deaths, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb15-12"><a href="#cb15-12" aria-hidden="true" tabindex="-1"></a>    <span class="at">stringency_index =</span> <span class="fu">mean</span>(stringency_index, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb15-13"><a href="#cb15-13" aria-hidden="true" tabindex="-1"></a>    <span class="at">hosp_patients =</span> <span class="fu">mean</span>(hosp_patients, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb15-14"><a href="#cb15-14" aria-hidden="true" tabindex="-1"></a>    <span class="at">reproduction_rate =</span> <span class="fu">mean</span>(reproduction_rate, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb15-15"><a href="#cb15-15" aria-hidden="true" tabindex="-1"></a>    <span class="at">date =</span> <span class="fu">max</span>(date),  <span class="co"># poslední den měsíce jako reprezentant</span></span>
<span id="cb15-16"><a href="#cb15-16" aria-hidden="true" tabindex="-1"></a>    <span class="at">.groups =</span> <span class="st">'drop'</span></span>
<span id="cb15-17"><a href="#cb15-17" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span></span>
<span id="cb15-18"><a href="#cb15-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(year, month)</span>
<span id="cb15-19"><a href="#cb15-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-20"><a href="#cb15-20" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"Počet měsíčních pozorování:"</span>, <span class="fu">nrow</span>(monthly_data), <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Počet měsíčních pozorování: 56 </code></pre>
</div>
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"Rozsah dat:"</span>, <span class="fu">range</span>(monthly_data<span class="sc">$</span>date), <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Rozsah dat: 18292 19939 </code></pre>
</div>
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a>data<span class="sc">$</span>year <span class="ot">&lt;-</span> <span class="fu">as.numeric</span>(<span class="fu">format</span>(data<span class="sc">$</span>date, <span class="st">"%Y"</span>))</span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a>data<span class="sc">$</span>week <span class="ot">&lt;-</span> <span class="fu">as.numeric</span>(<span class="fu">format</span>(data<span class="sc">$</span>date, <span class="st">"%U"</span>))  <span class="co"># týden v roce (0-53)</span></span>
<span id="cb19-3"><a href="#cb19-3" aria-hidden="true" tabindex="-1"></a>data<span class="sc">$</span>year_week <span class="ot">&lt;-</span> <span class="fu">paste</span>(data<span class="sc">$</span>year, <span class="fu">sprintf</span>(<span class="st">"%02d"</span>, data<span class="sc">$</span>week), <span class="at">sep =</span> <span class="st">"-W"</span>)</span>
<span id="cb19-4"><a href="#cb19-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-5"><a href="#cb19-5" aria-hidden="true" tabindex="-1"></a>data <span class="ot">&lt;-</span> data <span class="sc">%&gt;%</span></span>
<span id="cb19-6"><a href="#cb19-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(year, week, year_week) <span class="sc">%&gt;%</span></span>
<span id="cb19-7"><a href="#cb19-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(</span>
<span id="cb19-8"><a href="#cb19-8" aria-hidden="true" tabindex="-1"></a>    <span class="at">new_cases =</span> <span class="fu">sum</span>(new_cases, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb19-9"><a href="#cb19-9" aria-hidden="true" tabindex="-1"></a>    <span class="at">new_deaths =</span> <span class="fu">sum</span>(new_deaths, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb19-10"><a href="#cb19-10" aria-hidden="true" tabindex="-1"></a>    <span class="at">stringency_index =</span> <span class="fu">mean</span>(stringency_index, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb19-11"><a href="#cb19-11" aria-hidden="true" tabindex="-1"></a>    <span class="at">hosp_patients =</span> <span class="fu">mean</span>(hosp_patients, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb19-12"><a href="#cb19-12" aria-hidden="true" tabindex="-1"></a>    <span class="at">reproduction_rate =</span> <span class="fu">mean</span>(reproduction_rate, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb19-13"><a href="#cb19-13" aria-hidden="true" tabindex="-1"></a>    <span class="at">date =</span> <span class="fu">max</span>(date),  <span class="co"># poslední den týdne jako reprezentant</span></span>
<span id="cb19-14"><a href="#cb19-14" aria-hidden="true" tabindex="-1"></a>    <span class="at">.groups =</span> <span class="st">'drop'</span></span>
<span id="cb19-15"><a href="#cb19-15" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span></span>
<span id="cb19-16"><a href="#cb19-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(year, week) <span class="sc">%&gt;%</span></span>
<span id="cb19-17"><a href="#cb19-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(week <span class="sc">&gt;</span> <span class="dv">0</span>)  <span class="co"># odstraníme týden 0 (může být neúplný)</span></span>
<span id="cb19-18"><a href="#cb19-18" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb19-19"><a href="#cb19-19" aria-hidden="true" tabindex="-1"></a><span class="co"># Vytvoření časové řady</span></span>
<span id="cb19-20"><a href="#cb19-20" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"Data začínají od: "</span>,<span class="fu">as.numeric</span>(<span class="fu">format</span>(<span class="fu">min</span>(data<span class="sc">$</span>date), <span class="st">"%d"</span>)) , <span class="fu">as.numeric</span>(<span class="fu">format</span>(<span class="fu">min</span>(data<span class="sc">$</span>date), <span class="st">"%m"</span>)), <span class="fu">as.numeric</span>(<span class="fu">format</span>(<span class="fu">min</span>(data<span class="sc">$</span>date), <span class="st">"%Y"</span>)), <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Data začínají od:  11 1 2020 </code></pre>
</div>
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"Data končí: "</span>, <span class="fu">as.numeric</span>(<span class="fu">format</span>(<span class="fu">max</span>(data<span class="sc">$</span>date), <span class="st">"%d"</span>)), <span class="fu">as.numeric</span>(<span class="fu">format</span>(<span class="fu">max</span>(data<span class="sc">$</span>date), <span class="st">"%m"</span>)),<span class="fu">as.numeric</span>(<span class="fu">format</span>(<span class="fu">max</span>(data<span class="sc">$</span>date), <span class="st">"%Y"</span>)))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Data končí:  4 8 2024</code></pre>
</div>
</div>
<p>Nejdřív se zkontrolovalo, jestli nejsou chybějící hodnoty ve sloupcích, které by mohly dělat problém při analýze. Zkontrovalo se, jestli nejsou v datech mezery, kolik mají pozorování a jaký je v nich rozsah hodnot. Potom se udělala agregace na měsíční a týdenní součty. Použijeme týdenní agregaci.</p>
<p><strong>Proč týdenní agregace?:</strong></p>
<ul>
<li><p>Eliminuje víkendové efekty v hlášení případů.</p></li>
<li><p>Snižuje šum v datech způsobený administrativními procesy.</p></li>
<li><p>Zachovává sezónní vzorce, ale redukuje krátkodobé fluktuace.</p></li>
</ul>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb23"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a>start_year <span class="ot">&lt;-</span> <span class="fu">min</span>(monthly_data<span class="sc">$</span>year)</span>
<span id="cb23-2"><a href="#cb23-2" aria-hidden="true" tabindex="-1"></a><span class="co">#start_month &lt;- min(monthly_data$month[monthly_data$year == start_year])</span></span>
<span id="cb23-3"><a href="#cb23-3" aria-hidden="true" tabindex="-1"></a>start_week <span class="ot">&lt;-</span> <span class="fu">min</span>(data<span class="sc">$</span>week[data<span class="sc">$</span>year <span class="sc">==</span> start_year]<span class="sc">+</span><span class="dv">1</span>)</span>
<span id="cb23-4"><a href="#cb23-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-5"><a href="#cb23-5" aria-hidden="true" tabindex="-1"></a>ts_data <span class="ot">&lt;-</span> <span class="fu">ts</span>(data<span class="sc">$</span>new_cases, <span class="at">start =</span> <span class="fu">c</span>(start_year, start_week), <span class="at">frequency =</span> <span class="fl">52.18</span>)</span>
<span id="cb23-6"><a href="#cb23-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-7"><a href="#cb23-7" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"Počet pozorování:"</span>, <span class="fu">length</span>(ts_data), <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Počet pozorování: 240 </code></pre>
</div>
<div class="sourceCode cell-code" id="cb25"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"Rozsah hodnot:"</span>, <span class="fu">round</span>(<span class="fu">range</span>(ts_data, <span class="at">na.rm =</span> <span class="cn">TRUE</span>), <span class="dv">2</span>), <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Rozsah hodnot: 9 177772819 </code></pre>
</div>
<div class="sourceCode cell-code" id="cb27"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(ts_data)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>     Min.   1st Qu.    Median      Mean   3rd Qu.      Max. 
        9   1004123   9371322  13701635  17490811 177772819 </code></pre>
</div>
<div class="sourceCode cell-code" id="cb29"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(ts_data, <span class="dv">20</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Time Series:
Start = 2020.01916443082 
End = 2020.38328861633 
Frequency = 52.18 
 [1]       9     180     362    7589   50170   91959  125806   37063   34456
[10]   89115  281947  791666 1577828 2020659 2227938 2130027 2239825 2234431
[19] 2367536 2476900</code></pre>
</div>
<div class="sourceCode cell-code" id="cb31"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a><span class="fu">tail</span>(ts_data, <span class="dv">20</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Time Series:
Start = 2024.23533921043 
End = 2024.59946339594 
Frequency = 52.18 
 [1] 206535 459450 164568 162611 132459 141823 127919 140377 156102 133151
[11] 145262 150474 154478 160695 200701 205046 207990 236364 257506 214317</code></pre>
</div>
</div>
<p>Vytvořili jsme časovou řadu s týdenní frekvencí.</p>
</section>
<section id="grafické-zobrazení-řady" class="level2">
<h2 class="anchored" data-anchor-id="grafické-zobrazení-řady">Grafické zobrazení řady</h2>
<p>Zobrazíme hlavní řadu pomocí týdenních dat a boxplot graf podle měsíčních dat pro identifikaci sezónnosti.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb33"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb33-1"><a href="#cb33-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Grafické zobrazení hlavní řady</span></span>
<span id="cb33-2"><a href="#cb33-2" aria-hidden="true" tabindex="-1"></a>p1 <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(data, <span class="fu">aes</span>(<span class="at">x =</span> date, <span class="at">y =</span> new_cases)) <span class="sc">+</span></span>
<span id="cb33-3"><a href="#cb33-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="at">color =</span> <span class="st">"steelblue"</span>, <span class="at">alpha =</span> <span class="fl">0.7</span>) <span class="sc">+</span></span>
<span id="cb33-4"><a href="#cb33-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_smooth</span>(<span class="at">method =</span> <span class="st">"loess"</span>, <span class="at">color =</span> <span class="st">"red"</span>, <span class="at">se =</span> <span class="cn">FALSE</span>) <span class="sc">+</span></span>
<span id="cb33-5"><a href="#cb33-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Vývoj nových případů COVID-19"</span>,</span>
<span id="cb33-6"><a href="#cb33-6" aria-hidden="true" tabindex="-1"></a>       <span class="at">x =</span> <span class="st">"Datum"</span>, <span class="at">y =</span> <span class="st">"Počet nových případů"</span>,</span>
<span id="cb33-7"><a href="#cb33-7" aria-hidden="true" tabindex="-1"></a>       <span class="at">subtitle =</span> <span class="st">"Týdenní agregace denních dat s trendem (červená linie)"</span>) <span class="sc">+</span></span>
<span id="cb33-8"><a href="#cb33-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb33-9"><a href="#cb33-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">axis.text.x =</span> <span class="fu">element_text</span>(<span class="at">angle =</span> <span class="dv">45</span>, <span class="at">hjust =</span> <span class="dv">1</span>))</span>
<span id="cb33-10"><a href="#cb33-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-11"><a href="#cb33-11" aria-hidden="true" tabindex="-1"></a><span class="co"># Boxplot podle měsíců pro identifikaci sezónnosti</span></span>
<span id="cb33-12"><a href="#cb33-12" aria-hidden="true" tabindex="-1"></a>p2 <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(monthly_data, <span class="fu">aes</span>(<span class="at">x =</span> <span class="fu">factor</span>(month), <span class="at">y =</span> new_cases)) <span class="sc">+</span></span>
<span id="cb33-13"><a href="#cb33-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_boxplot</span>(<span class="at">fill =</span> <span class="st">"lightblue"</span>, <span class="at">alpha =</span> <span class="fl">0.7</span>) <span class="sc">+</span></span>
<span id="cb33-14"><a href="#cb33-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">alpha =</span> <span class="fl">0.4</span>, <span class="at">position =</span> <span class="fu">position_jitter</span>(<span class="at">width =</span> <span class="fl">0.2</span>)) <span class="sc">+</span></span>
<span id="cb33-15"><a href="#cb33-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_discrete</span>(<span class="at">labels =</span> month.abb) <span class="sc">+</span></span>
<span id="cb33-16"><a href="#cb33-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Sezónní rozdělení měsíčních případů"</span>,</span>
<span id="cb33-17"><a href="#cb33-17" aria-hidden="true" tabindex="-1"></a>       <span class="at">x =</span> <span class="st">"Měsíc"</span>, <span class="at">y =</span> <span class="st">"Počet nových případů"</span>) <span class="sc">+</span></span>
<span id="cb33-18"><a href="#cb33-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb33-19"><a href="#cb33-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">axis.text.x =</span> <span class="fu">element_text</span>(<span class="at">angle =</span> <span class="dv">45</span>, <span class="at">hjust =</span> <span class="dv">1</span>))</span>
<span id="cb33-20"><a href="#cb33-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-21"><a href="#cb33-21" aria-hidden="true" tabindex="-1"></a><span class="fu">grid.arrange</span>(p1, p2, <span class="at">ncol =</span> <span class="dv">1</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="covid_data_analyse_files/figure-html/unnamed-chunk-4-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" width="6000"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="dekompozice-a-identifikace-trendu" class="level2">
<h2 class="anchored" data-anchor-id="dekompozice-a-identifikace-trendu">Dekompozice a identifikace trendu</h2>
<section id="logaritmická-transformace" class="level4">
<h4 class="anchored" data-anchor-id="logaritmická-transformace">Logaritmická transformace</h4>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb34"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb34-1"><a href="#cb34-1" aria-hidden="true" tabindex="-1"></a>ts_log <span class="ot">&lt;-</span> <span class="fu">log1p</span>(ts_data)  <span class="co"># log stabilizace</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><strong>Důvody:</strong></p>
<ul>
<li><p>Stabilizuje varianci (heteroskedasticita)</p></li>
<li><p>Lineární trendy se stávají exponenciálními ve skutečných datech</p></li>
<li><p>Zlepšuje normalitu reziduí</p></li>
</ul>
</section>
<section id="dekompozice-časové-řady" class="level4">
<h4 class="anchored" data-anchor-id="dekompozice-časové-řady">Dekompozice časové řady</h4>
<p>Dekompozice umožňuje pochopit strukturu dat, identifikuje sílu trendové vs.&nbsp;sezónní složky a pomáhá při výběru vhodného typu modelu (aditivní vs.&nbsp;multiplikativní).</p>
<p>STL dekompozice je robustní vůči sezónním hodnotám, zvládá změny v sezónních vzorcích a umožňuje flexibilní nastavení trend vs.&nbsp;sezónní komponenty.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb35"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb35-1"><a href="#cb35-1" aria-hidden="true" tabindex="-1"></a><span class="co"># STL dekompozice</span></span>
<span id="cb35-2"><a href="#cb35-2" aria-hidden="true" tabindex="-1"></a>stl_decomp <span class="ot">&lt;-</span> <span class="fu">stl</span>(ts_log, <span class="at">s.window =</span> <span class="st">"periodic"</span>, <span class="at">t.window =</span> <span class="cn">NULL</span>, <span class="at">robust =</span> <span class="cn">TRUE</span>)</span>
<span id="cb35-3"><a href="#cb35-3" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(stl_decomp, <span class="at">main =</span> <span class="st">"STL dekompozice časové řady nových případů"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="covid_data_analyse_files/figure-html/unnamed-chunk-6-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" width="6000"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="identifikace-trendu-pomocí-vyhlazení" class="level4">
<h4 class="anchored" data-anchor-id="identifikace-trendu-pomocí-vyhlazení">Identifikace trendu pomocí vyhlazení</h4>
<ul>
<li>MA(4): Měsíční vyhlazení - Zobrazí střednědobé trendy.</li>
<li>MA(52): Roční vyhlazení - Zachytí dlouhodobý trend.</li>
<li>Exponenciální vyhlazení - Dává vyšší váhu novějším pozorováním, vhodné pro predikci.</li>
</ul>
<p>Výsledky říkají, která metoda nejlépe zachycuje základní trend, jak silné jsou krátkodobé vs.&nbsp;dlouhodobé fluktuace, zda je trend stabilní nebo se mění v čase.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb36"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb36-1"><a href="#cb36-1" aria-hidden="true" tabindex="-1"></a>start_week <span class="ot">&lt;-</span> <span class="fu">min</span>(data<span class="sc">$</span>week[data<span class="sc">$</span>year <span class="sc">==</span> start_year])</span>
<span id="cb36-2"><a href="#cb36-2" aria-hidden="true" tabindex="-1"></a>ts_weekly_data <span class="ot">&lt;-</span> <span class="fu">ts</span>(data<span class="sc">$</span>new_cases, <span class="at">start =</span> <span class="fu">c</span>(start_year, start_week), <span class="at">frequency =</span> <span class="fl">52.18</span>)</span>
<span id="cb36-3"><a href="#cb36-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-4"><a href="#cb36-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Klouzavé průměry různých řádů</span></span>
<span id="cb36-5"><a href="#cb36-5" aria-hidden="true" tabindex="-1"></a>ma_4 <span class="ot">&lt;-</span> <span class="fu">SMA</span>(data<span class="sc">$</span>new_cases, <span class="at">n =</span> <span class="dv">4</span>) </span>
<span id="cb36-6"><a href="#cb36-6" aria-hidden="true" tabindex="-1"></a>ma_52 <span class="ot">&lt;-</span> <span class="fu">SMA</span>(data<span class="sc">$</span>new_cases, <span class="at">n =</span> <span class="fl">52.18</span>) </span>
<span id="cb36-7"><a href="#cb36-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-8"><a href="#cb36-8" aria-hidden="true" tabindex="-1"></a><span class="co"># Exponenciální vyrovnání - jednodušší přístup</span></span>
<span id="cb36-9"><a href="#cb36-9" aria-hidden="true" tabindex="-1"></a>exp_smooth_model <span class="ot">&lt;-</span> <span class="fu">HoltWinters</span>(ts_weekly_data, <span class="at">gamma =</span> <span class="cn">FALSE</span>)</span>
<span id="cb36-10"><a href="#cb36-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-11"><a href="#cb36-11" aria-hidden="true" tabindex="-1"></a><span class="co"># Vytvoříme jednoduché exponenciální vyhlazení pomocí ETS</span></span>
<span id="cb36-12"><a href="#cb36-12" aria-hidden="true" tabindex="-1"></a>ets_model <span class="ot">&lt;-</span> <span class="fu">ets</span>(ts_weekly_data, <span class="at">model =</span> <span class="st">"AAN"</span>, <span class="at">damped =</span> <span class="cn">FALSE</span>)</span>
<span id="cb36-13"><a href="#cb36-13" aria-hidden="true" tabindex="-1"></a>exp_smooth_fitted <span class="ot">&lt;-</span> <span class="fu">fitted</span>(ets_model)</span>
<span id="cb36-14"><a href="#cb36-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-15"><a href="#cb36-15" aria-hidden="true" tabindex="-1"></a><span class="co"># Zajistíme stejnou délku (ETS vrací stejnou délku jako originální data)</span></span>
<span id="cb36-16"><a href="#cb36-16" aria-hidden="true" tabindex="-1"></a>n_obs <span class="ot">&lt;-</span> <span class="fu">length</span>(data<span class="sc">$</span>new_cases)</span>
<span id="cb36-17"><a href="#cb36-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-18"><a href="#cb36-18" aria-hidden="true" tabindex="-1"></a><span class="co"># Pokud je exp_smooth_fitted kratší, doplníme NA na začátek</span></span>
<span id="cb36-19"><a href="#cb36-19" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span>(<span class="fu">length</span>(exp_smooth_fitted) <span class="sc">&lt;</span> n_obs) {</span>
<span id="cb36-20"><a href="#cb36-20" aria-hidden="true" tabindex="-1"></a>  exp_smooth_full <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="fu">rep</span>(<span class="cn">NA</span>, n_obs <span class="sc">-</span> <span class="fu">length</span>(exp_smooth_fitted)), </span>
<span id="cb36-21"><a href="#cb36-21" aria-hidden="true" tabindex="-1"></a>                       <span class="fu">as.numeric</span>(exp_smooth_fitted))</span>
<span id="cb36-22"><a href="#cb36-22" aria-hidden="true" tabindex="-1"></a>} <span class="cf">else</span> {</span>
<span id="cb36-23"><a href="#cb36-23" aria-hidden="true" tabindex="-1"></a>  exp_smooth_full <span class="ot">&lt;-</span> <span class="fu">as.numeric</span>(exp_smooth_fitted[<span class="dv">1</span><span class="sc">:</span>n_obs])</span>
<span id="cb36-24"><a href="#cb36-24" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb36-25"><a href="#cb36-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-26"><a href="#cb36-26" aria-hidden="true" tabindex="-1"></a><span class="co"># Grafické srovnání - pouze metody, které máme</span></span>
<span id="cb36-27"><a href="#cb36-27" aria-hidden="true" tabindex="-1"></a>trend_data <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(</span>
<span id="cb36-28"><a href="#cb36-28" aria-hidden="true" tabindex="-1"></a>  <span class="at">date =</span> data<span class="sc">$</span>date,</span>
<span id="cb36-29"><a href="#cb36-29" aria-hidden="true" tabindex="-1"></a>  <span class="at">original =</span> data<span class="sc">$</span>new_cases,</span>
<span id="cb36-30"><a href="#cb36-30" aria-hidden="true" tabindex="-1"></a>  <span class="at">ma_4 =</span> ma_4,</span>
<span id="cb36-31"><a href="#cb36-31" aria-hidden="true" tabindex="-1"></a>  <span class="at">ma_52 =</span> ma_52,</span>
<span id="cb36-32"><a href="#cb36-32" aria-hidden="true" tabindex="-1"></a>  <span class="at">exp_smooth =</span> exp_smooth_full</span>
<span id="cb36-33"><a href="#cb36-33" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb36-34"><a href="#cb36-34" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-35"><a href="#cb36-35" aria-hidden="true" tabindex="-1"></a><span class="co"># Přidáme exponenciální vyhlazení</span></span>
<span id="cb36-36"><a href="#cb36-36" aria-hidden="true" tabindex="-1"></a>trend_data<span class="sc">$</span>exp_smooth <span class="ot">&lt;-</span> exp_smooth_full</span>
<span id="cb36-37"><a href="#cb36-37" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-38"><a href="#cb36-38" aria-hidden="true" tabindex="-1"></a>trend_plot <span class="ot">&lt;-</span> trend_data <span class="sc">%&gt;%</span></span>
<span id="cb36-39"><a href="#cb36-39" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(<span class="at">cols =</span> <span class="sc">-</span>date, <span class="at">names_to =</span> <span class="st">"method"</span>, <span class="at">values_to =</span> <span class="st">"value"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb36-40"><a href="#cb36-40" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(value)) <span class="sc">%&gt;%</span>  <span class="co"># Odfiltrujeme NA hodnoty</span></span>
<span id="cb36-41"><a href="#cb36-41" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> date, <span class="at">y =</span> value, <span class="at">color =</span> method)) <span class="sc">+</span></span>
<span id="cb36-42"><a href="#cb36-42" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="at">alpha =</span> <span class="fl">0.7</span>, <span class="at">size =</span> <span class="fl">0.65</span>) <span class="sc">+</span></span>
<span id="cb36-43"><a href="#cb36-43" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="st">"original"</span> <span class="ot">=</span> <span class="st">"gray50"</span>, <span class="st">"ma_4"</span> <span class="ot">=</span> <span class="st">"blue"</span>, <span class="st">"ma_52"</span> <span class="ot">=</span> <span class="st">"red"</span>, <span class="st">"exp_smooth"</span> <span class="ot">=</span> <span class="st">"purple"</span>),</span>
<span id="cb36-44"><a href="#cb36-44" aria-hidden="true" tabindex="-1"></a>                     <span class="at">name =</span> <span class="st">"Metoda"</span>,</span>
<span id="cb36-45"><a href="#cb36-45" aria-hidden="true" tabindex="-1"></a>                     <span class="at">labels =</span> <span class="fu">c</span>(<span class="st">"original"</span> <span class="ot">=</span> <span class="st">"Originální data"</span>, </span>
<span id="cb36-46"><a href="#cb36-46" aria-hidden="true" tabindex="-1"></a>                                <span class="st">"ma_4"</span> <span class="ot">=</span> <span class="st">"MA(4)"</span>, </span>
<span id="cb36-47"><a href="#cb36-47" aria-hidden="true" tabindex="-1"></a>                                <span class="st">"ma_52"</span> <span class="ot">=</span> <span class="st">"MA(52)"</span>, <span class="st">"exp_smooth"</span> <span class="ot">=</span> <span class="st">"Exp. vyhlazení"</span>)) <span class="sc">+</span></span>
<span id="cb36-48"><a href="#cb36-48" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Srovnání metod vyhlazení trendu"</span>,</span>
<span id="cb36-49"><a href="#cb36-49" aria-hidden="true" tabindex="-1"></a>       <span class="at">x =</span> <span class="st">"Datum"</span>, <span class="at">y =</span> <span class="st">"Hodnota"</span>) <span class="sc">+</span></span>
<span id="cb36-50"><a href="#cb36-50" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb36-51"><a href="#cb36-51" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">"bottom"</span>)</span>
<span id="cb36-52"><a href="#cb36-52" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-53"><a href="#cb36-53" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(trend_plot)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="covid_data_analyse_files/figure-html/unnamed-chunk-7-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" width="6000"></p>
</figure>
</div>
</div>
<div class="sourceCode cell-code" id="cb37"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb37-1"><a href="#cb37-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Analýza trendové složky</span></span>
<span id="cb37-2"><a href="#cb37-2" aria-hidden="true" tabindex="-1"></a>trend_component <span class="ot">&lt;-</span> stl_decomp<span class="sc">$</span>time.series[,<span class="st">"trend"</span>]</span>
<span id="cb37-3"><a href="#cb37-3" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"Souhrn trendové složky:</span><span class="sc">\n</span><span class="st">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Souhrn trendové složky:</code></pre>
</div>
<div class="sourceCode cell-code" id="cb39"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb39-1"><a href="#cb39-1" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(<span class="fu">summary</span>(trend_component))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>   Min. 1st Qu.  Median    Mean 3rd Qu.    Max. 
  11.86   14.45   15.83   15.31   16.53   16.78 </code></pre>
</div>
<div class="sourceCode cell-code" id="cb41"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb41-1"><a href="#cb41-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Analýza sezónní složky</span></span>
<span id="cb41-2"><a href="#cb41-2" aria-hidden="true" tabindex="-1"></a>seasonal_component <span class="ot">&lt;-</span> stl_decomp<span class="sc">$</span>time.series[,<span class="st">"seasonal"</span>]</span>
<span id="cb41-3"><a href="#cb41-3" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"</span><span class="sc">\n</span><span class="st">Souhrn sezónní složky:</span><span class="sc">\n</span><span class="st">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Souhrn sezónní složky:</code></pre>
</div>
<div class="sourceCode cell-code" id="cb43"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb43-1"><a href="#cb43-1" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(<span class="fu">summary</span>(seasonal_component))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>    Min.  1st Qu.   Median     Mean  3rd Qu.     Max. 
-0.23906 -0.19227  0.06284  0.14126  0.52185  0.66811 </code></pre>
</div>
</div>
</section>
</section>
<section id="hledání-optimálního-funkčního-modelu-trend-sezónnost" class="level2">
<h2 class="anchored" data-anchor-id="hledání-optimálního-funkčního-modelu-trend-sezónnost">Hledání optimálního funkčního modelu (trend + sezónnost)</h2>
<p>Testování různých modelů s kombinacemi, jejich srovnání a grafické zobrazení fitování.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb45"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb45-1"><a href="#cb45-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Příprava dat pro regresní model</span></span>
<span id="cb45-2"><a href="#cb45-2" aria-hidden="true" tabindex="-1"></a>data<span class="sc">$</span>t <span class="ot">&lt;-</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">nrow</span>(data)</span>
<span id="cb45-3"><a href="#cb45-3" aria-hidden="true" tabindex="-1"></a>data<span class="sc">$</span>sin_365 <span class="ot">&lt;-</span> <span class="fu">sin</span>(<span class="dv">2</span> <span class="sc">*</span> pi <span class="sc">*</span> data<span class="sc">$</span>t <span class="sc">/</span> <span class="fl">52.18</span>)</span>
<span id="cb45-4"><a href="#cb45-4" aria-hidden="true" tabindex="-1"></a>data<span class="sc">$</span>cos_365 <span class="ot">&lt;-</span> <span class="fu">cos</span>(<span class="dv">2</span> <span class="sc">*</span> pi <span class="sc">*</span> data<span class="sc">$</span>t <span class="sc">/</span> <span class="fl">52.18</span>)</span>
<span id="cb45-5"><a href="#cb45-5" aria-hidden="true" tabindex="-1"></a>data<span class="sc">$</span>sin_7 <span class="ot">&lt;-</span> <span class="fu">sin</span>(<span class="dv">2</span> <span class="sc">*</span> pi <span class="sc">*</span> data<span class="sc">$</span>t <span class="sc">/</span> <span class="dv">4</span>)</span>
<span id="cb45-6"><a href="#cb45-6" aria-hidden="true" tabindex="-1"></a>data<span class="sc">$</span>cos_7 <span class="ot">&lt;-</span> <span class="fu">cos</span>(<span class="dv">2</span> <span class="sc">*</span> pi <span class="sc">*</span> data<span class="sc">$</span>t <span class="sc">/</span> <span class="dv">4</span>)</span>
<span id="cb45-7"><a href="#cb45-7" aria-hidden="true" tabindex="-1"></a>data<span class="sc">$</span>sin_1 <span class="ot">&lt;-</span> <span class="fu">sin</span>(<span class="dv">2</span> <span class="sc">*</span> pi <span class="sc">*</span> data<span class="sc">$</span>t <span class="sc">/</span> <span class="dv">1</span>)</span>
<span id="cb45-8"><a href="#cb45-8" aria-hidden="true" tabindex="-1"></a>data<span class="sc">$</span>cos_1 <span class="ot">&lt;-</span> <span class="fu">cos</span>(<span class="dv">2</span> <span class="sc">*</span> pi <span class="sc">*</span> data<span class="sc">$</span>t <span class="sc">/</span> <span class="dv">1</span>)</span>
<span id="cb45-9"><a href="#cb45-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-10"><a href="#cb45-10" aria-hidden="true" tabindex="-1"></a><span class="co"># Model 1: Lineární trend + roční sezónnost</span></span>
<span id="cb45-11"><a href="#cb45-11" aria-hidden="true" tabindex="-1"></a>model1 <span class="ot">&lt;-</span> <span class="fu">lm</span>(<span class="fu">log1p</span>(new_cases) <span class="sc">~</span> t <span class="sc">+</span> sin_365 <span class="sc">+</span> cos_365, <span class="at">data =</span> data)</span>
<span id="cb45-12"><a href="#cb45-12" aria-hidden="true" tabindex="-1"></a><span class="co"># Model 2: Polynomiální trend + roční sezónnost</span></span>
<span id="cb45-13"><a href="#cb45-13" aria-hidden="true" tabindex="-1"></a>model2 <span class="ot">&lt;-</span> <span class="fu">lm</span>(<span class="fu">log1p</span>(new_cases) <span class="sc">~</span> <span class="fu">poly</span>(t, <span class="dv">2</span>) <span class="sc">+</span> sin_365 <span class="sc">+</span> cos_365, <span class="at">data =</span> data)</span>
<span id="cb45-14"><a href="#cb45-14" aria-hidden="true" tabindex="-1"></a><span class="co"># Model 3: Lineární trend + roční + měsíční sezónnost</span></span>
<span id="cb45-15"><a href="#cb45-15" aria-hidden="true" tabindex="-1"></a>model3 <span class="ot">&lt;-</span> <span class="fu">lm</span>(<span class="fu">log1p</span>(new_cases) <span class="sc">~</span> t <span class="sc">+</span> sin_365 <span class="sc">+</span> cos_365 <span class="sc">+</span> sin_7 <span class="sc">+</span> cos_7, <span class="at">data =</span> data)</span>
<span id="cb45-16"><a href="#cb45-16" aria-hidden="true" tabindex="-1"></a><span class="co"># Model 4: Polynomiální trend + roční + měsíční sezónnost</span></span>
<span id="cb45-17"><a href="#cb45-17" aria-hidden="true" tabindex="-1"></a>model4 <span class="ot">&lt;-</span> <span class="fu">lm</span>(<span class="fu">log1p</span>(new_cases) <span class="sc">~</span> <span class="fu">poly</span>(t, <span class="dv">2</span>) <span class="sc">+</span> sin_365 <span class="sc">+</span> cos_365 <span class="sc">+</span> sin_7 <span class="sc">+</span> cos_7, <span class="at">data =</span> data)</span>
<span id="cb45-18"><a href="#cb45-18" aria-hidden="true" tabindex="-1"></a><span class="co"># Model 5: Lineární trend + roční + měsíční sezónnost + týdenní sezónnost</span></span>
<span id="cb45-19"><a href="#cb45-19" aria-hidden="true" tabindex="-1"></a>model5 <span class="ot">&lt;-</span> <span class="fu">lm</span>(<span class="fu">log1p</span>(new_cases) <span class="sc">~</span> t <span class="sc">+</span> sin_365 <span class="sc">+</span> cos_365 <span class="sc">+</span> sin_7 <span class="sc">+</span> cos_7 <span class="sc">+</span> sin_1 <span class="sc">+</span> cos_1, <span class="at">data =</span> data)</span>
<span id="cb45-20"><a href="#cb45-20" aria-hidden="true" tabindex="-1"></a><span class="co"># Model 6: Polynomiální trend + roční + měsíční + týdenní sezónnost</span></span>
<span id="cb45-21"><a href="#cb45-21" aria-hidden="true" tabindex="-1"></a>model6 <span class="ot">&lt;-</span> <span class="fu">lm</span>(<span class="fu">log1p</span>(new_cases) <span class="sc">~</span> <span class="fu">poly</span>(t, <span class="dv">2</span>) <span class="sc">+</span> sin_365 <span class="sc">+</span> cos_365 <span class="sc">+</span> sin_7 <span class="sc">+</span> cos_7 <span class="sc">+</span> sin_1 <span class="sc">+</span> cos_1, <span class="at">data =</span> data)</span>
<span id="cb45-22"><a href="#cb45-22" aria-hidden="true" tabindex="-1"></a><span class="co"># Model 7: Lineární trend + roční + týdenní sezónnost</span></span>
<span id="cb45-23"><a href="#cb45-23" aria-hidden="true" tabindex="-1"></a>model7 <span class="ot">&lt;-</span> <span class="fu">lm</span>(<span class="fu">log1p</span>(new_cases) <span class="sc">~</span> t <span class="sc">+</span> sin_365 <span class="sc">+</span> cos_365 <span class="sc">+</span> sin_1 <span class="sc">+</span> cos_1, <span class="at">data =</span> data)</span>
<span id="cb45-24"><a href="#cb45-24" aria-hidden="true" tabindex="-1"></a><span class="co"># Model 8: Polynomiální trend + roční + týdenní sezónnost</span></span>
<span id="cb45-25"><a href="#cb45-25" aria-hidden="true" tabindex="-1"></a>model8 <span class="ot">&lt;-</span> <span class="fu">lm</span>(<span class="fu">log1p</span>(new_cases) <span class="sc">~</span> <span class="fu">poly</span>(t, <span class="dv">2</span>) <span class="sc">+</span> sin_365 <span class="sc">+</span> cos_365 <span class="sc">+</span> sin_1 <span class="sc">+</span> cos_1, <span class="at">data =</span> data)</span>
<span id="cb45-26"><a href="#cb45-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-27"><a href="#cb45-27" aria-hidden="true" tabindex="-1"></a><span class="co"># Srovnání modelů</span></span>
<span id="cb45-28"><a href="#cb45-28" aria-hidden="true" tabindex="-1"></a>models <span class="ot">&lt;-</span> <span class="fu">list</span>(model1, model2, model3, model4, model5, model6, model7, model8)</span>
<span id="cb45-29"><a href="#cb45-29" aria-hidden="true" tabindex="-1"></a>model_names <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"Lin+Roční"</span>, <span class="st">"Poly+Roční"</span>, <span class="st">"Lin+Roční+Měsíční"</span>, <span class="st">"Poly+Roční+Měsíční"</span>, <span class="st">"Lin+Roční+Měsíční+Týdenní"</span> ,<span class="st">"Poly+Roční+Měsíční+Týdenní"</span>, <span class="st">"Lin+Roční+Týdenní"</span>, <span class="st">"Poly+Roční+Týdenní"</span>)</span>
<span id="cb45-30"><a href="#cb45-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-31"><a href="#cb45-31" aria-hidden="true" tabindex="-1"></a><span class="co"># AIC a BIC srovnání</span></span>
<span id="cb45-32"><a href="#cb45-32" aria-hidden="true" tabindex="-1"></a>comparison <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(</span>
<span id="cb45-33"><a href="#cb45-33" aria-hidden="true" tabindex="-1"></a>  <span class="at">Model =</span> model_names,</span>
<span id="cb45-34"><a href="#cb45-34" aria-hidden="true" tabindex="-1"></a>  <span class="at">AIC =</span> <span class="fu">sapply</span>(models, AIC),</span>
<span id="cb45-35"><a href="#cb45-35" aria-hidden="true" tabindex="-1"></a>  <span class="at">BIC =</span> <span class="fu">sapply</span>(models, BIC),</span>
<span id="cb45-36"><a href="#cb45-36" aria-hidden="true" tabindex="-1"></a>  <span class="at">R_squared =</span> <span class="fu">sapply</span>(models, <span class="cf">function</span>(x) <span class="fu">summary</span>(x)<span class="sc">$</span>r.squared)</span>
<span id="cb45-37"><a href="#cb45-37" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb45-38"><a href="#cb45-38" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(comparison)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>                       Model       AIC       BIC  R_squared
1                  Lin+Roční 1057.5746 1074.9778 0.07559369
2                 Poly+Roční  796.9181  817.8019 0.69056463
3          Lin+Roční+Měsíční 1061.3812 1085.7456 0.07633864
4         Poly+Roční+Měsíční  800.3413  828.1864 0.69130742
5  Lin+Roční+Měsíční+Týdenní 1063.3215 1091.1666 0.07656836
6 Poly+Roční+Měsíční+Týdenní  802.2167  833.5424 0.69146762
7          Lin+Roční+Týdenní 1059.5050 1080.3888 0.07586198
8         Poly+Roční+Týdenní  798.8182  823.1827 0.69069337</code></pre>
</div>
<div class="sourceCode cell-code" id="cb47"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb47-1"><a href="#cb47-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Nejlepší model podle AIC</span></span>
<span id="cb47-2"><a href="#cb47-2" aria-hidden="true" tabindex="-1"></a>best_func_model <span class="ot">&lt;-</span> models[[<span class="fu">which.min</span>(comparison<span class="sc">$</span>AIC)]]</span>
<span id="cb47-3"><a href="#cb47-3" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(<span class="fu">summary</span>(best_func_model))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
lm(formula = log1p(new_cases) ~ poly(t, 2) + sin_365 + cos_365, 
    data = data)

Residuals:
    Min      1Q  Median      3Q     Max 
-9.6746 -0.5697  0.0441  0.9198  2.7103 

Coefficients:
             Estimate Std. Error t value Pr(&gt;|t|)    
(Intercept)  15.17992    0.08136 186.575  &lt; 2e-16 ***
poly(t, 2)1  -7.70559    1.25709  -6.130 3.69e-09 ***
poly(t, 2)2 -27.64032    1.27899 -21.611  &lt; 2e-16 ***
sin_365      -0.05864    0.11785  -0.498    0.619    
cos_365      -0.11446    0.11427  -1.002    0.318    
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

Residual standard error: 1.255 on 235 degrees of freedom
Multiple R-squared:  0.6906,    Adjusted R-squared:  0.6853 
F-statistic: 131.1 on 4 and 235 DF,  p-value: &lt; 2.2e-16</code></pre>
</div>
<div class="sourceCode cell-code" id="cb49"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb49-1"><a href="#cb49-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Grafické zobrazení fitování</span></span>
<span id="cb49-2"><a href="#cb49-2" aria-hidden="true" tabindex="-1"></a>data<span class="sc">$</span>fitted_func <span class="ot">&lt;-</span>  <span class="fu">expm1</span>(<span class="fu">fitted</span>(best_func_model))</span>
<span id="cb49-3"><a href="#cb49-3" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(data, <span class="fu">aes</span>(<span class="at">x =</span> date)) <span class="sc">+</span></span>
<span id="cb49-4"><a href="#cb49-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">y =</span> new_cases), <span class="at">color =</span> <span class="st">"black"</span>, <span class="at">alpha =</span> <span class="fl">0.6</span>, <span class="at">size =</span> <span class="fl">0.5</span>) <span class="sc">+</span></span>
<span id="cb49-5"><a href="#cb49-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">y =</span> fitted_func), <span class="at">color =</span> <span class="st">"red"</span>, <span class="at">size =</span> <span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb49-6"><a href="#cb49-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Nejlepší funkční model"</span>,</span>
<span id="cb49-7"><a href="#cb49-7" aria-hidden="true" tabindex="-1"></a>       <span class="at">x =</span> <span class="st">"Datum"</span>, <span class="at">y =</span> <span class="st">"Počet případů"</span>,</span>
<span id="cb49-8"><a href="#cb49-8" aria-hidden="true" tabindex="-1"></a>       <span class="at">subtitle =</span> <span class="fu">paste</span>(<span class="st">"Model:"</span>, model_names[<span class="fu">which.min</span>(comparison<span class="sc">$</span>AIC)])) <span class="sc">+</span></span>
<span id="cb49-9"><a href="#cb49-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="covid_data_analyse_files/figure-html/unnamed-chunk-8-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" width="6000"></p>
</figure>
</div>
</div>
</div>
<p>Nejlepší funkční model podle AIC je model s polynomiálním trendem a roční sezónností. Model vysvětluje značnou část variability dat.</p>
</section>
<section id="hledání-optimálního-sarima-modelu" class="level2">
<h2 class="anchored" data-anchor-id="hledání-optimálního-sarima-modelu">Hledání optimálního SARIMA modelu</h2>
<section id="kontrola-stacionarity" class="level4">
<h4 class="anchored" data-anchor-id="kontrola-stacionarity">Kontrola stacionarity</h4>
<p><strong>ADF test</strong>: Testuje přítomnost jednotkového kořene.</p>
<p><strong>KPSS test</strong>: Testuje stacionaritu kolem trendu. Pokud je řada nestacionární, aplikujeme diferenciaci.</p>
<p><strong>Stacionární řada</strong>: denní změny (rozdíly) těchto počtů, kolísají kolem nuly bez trendu</p>
<p><strong>Nestacionární řada</strong>: počty covidových případů, mají trend (rostou/klesají), sezónnost (vlny).</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb50"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb50-1"><a href="#cb50-1" aria-hidden="true" tabindex="-1"></a>ts_diff <span class="ot">&lt;-</span> <span class="fu">diff</span>(ts_log) <span class="co"># 1. diferenciace</span></span>
<span id="cb50-2"><a href="#cb50-2" aria-hidden="true" tabindex="-1"></a><span class="co"># Kontrola stacionarity</span></span>
<span id="cb50-3"><a href="#cb50-3" aria-hidden="true" tabindex="-1"></a>adf_test <span class="ot">&lt;-</span> <span class="fu">adf.test</span>(ts_diff)</span>
<span id="cb50-4"><a href="#cb50-4" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(<span class="fu">paste</span>(<span class="st">"ADF test p-hodnota:"</span>, <span class="fu">round</span>(adf_test<span class="sc">$</span>p.value, <span class="dv">4</span>)))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "ADF test p-hodnota: 0.01"</code></pre>
</div>
<div class="sourceCode cell-code" id="cb52"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb52-1"><a href="#cb52-1" aria-hidden="true" tabindex="-1"></a><span class="co"># KPSS test stacionarity</span></span>
<span id="cb52-2"><a href="#cb52-2" aria-hidden="true" tabindex="-1"></a>kpss_test <span class="ot">&lt;-</span> <span class="fu">kpss.test</span>(ts_diff)</span>
<span id="cb52-3"><a href="#cb52-3" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(<span class="fu">paste</span>(<span class="st">"KPSS test p-hodnota:"</span>, <span class="fu">round</span>(kpss_test<span class="sc">$</span>p.value, <span class="dv">4</span>)))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "KPSS test p-hodnota: 0.01"</code></pre>
</div>
</div>
<p>ADF a KPSS testy říkají, že řada je nestacionární, proto se dělá diferenciace. Řada má sezónní trend.</p>
</section>
<section id="pacf-a-acf-grafy" class="level4">
<h4 class="anchored" data-anchor-id="pacf-a-acf-grafy">PACF a ACF grafy</h4>
<p><strong>ACF (Autokorelační funkce)</strong>: Ukazuje míru korelace mezi hodnotami časové řady a jejími zpožděnými verzemi (lagy). Pokud je ACF výrazná u několika lagů, znamená to, že minulost silně ovlivňuje současnost. Postupný pokles ACF může naznačovat MA (moving average) proces.</p>
<p><strong>PACF (Parciální ACF)</strong>: Ukazuje korelaci mezi hodnotami časové řady a jejich lagy po odečtení vlivu mezilehlých lagů. Výrazná hodnota PACF na určitém lagu (např. lag 2) znamená, že tento lag má přímý vliv na současnost. Pokud PACF náhle klesne po určitém lagu, může to naznačovat AR (Autoregressive) proces.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb54"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb54-1"><a href="#cb54-1" aria-hidden="true" tabindex="-1"></a><span class="co"># ACF a PACF grafy</span></span>
<span id="cb54-2"><a href="#cb54-2" aria-hidden="true" tabindex="-1"></a><span class="fu">par</span>(<span class="at">mfrow =</span> <span class="fu">c</span>(<span class="dv">2</span>,<span class="dv">1</span>))</span>
<span id="cb54-3"><a href="#cb54-3" aria-hidden="true" tabindex="-1"></a><span class="fu">acf</span>(ts_data, <span class="at">main =</span> <span class="st">"ACF původní řady"</span>, <span class="at">lag.max =</span> <span class="dv">100</span>)</span>
<span id="cb54-4"><a href="#cb54-4" aria-hidden="true" tabindex="-1"></a><span class="fu">pacf</span>(ts_data, <span class="at">main =</span> <span class="st">"PACF původní řady"</span>, <span class="at">lag.max =</span> <span class="dv">100</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="covid_data_analyse_files/figure-html/unnamed-chunk-10-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" width="6000"></p>
</figure>
</div>
</div>
<div class="sourceCode cell-code" id="cb55"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb55-1"><a href="#cb55-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Diferenciace pokud je potřeba</span></span>
<span id="cb55-2"><a href="#cb55-2" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span>(adf_test<span class="sc">$</span>p.value <span class="sc">&gt;</span> <span class="fl">0.05</span>) {</span>
<span id="cb55-3"><a href="#cb55-3" aria-hidden="true" tabindex="-1"></a>  ts_diff <span class="ot">&lt;-</span> <span class="fu">diff</span>(ts_data)</span>
<span id="cb55-4"><a href="#cb55-4" aria-hidden="true" tabindex="-1"></a>  adf_diff <span class="ot">&lt;-</span> <span class="fu">adf.test</span>(ts_diff)</span>
<span id="cb55-5"><a href="#cb55-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">print</span>(<span class="fu">paste</span>(<span class="st">"ADF test diferencované řady:"</span>, <span class="fu">round</span>(adf_diff<span class="sc">$</span>p.value, <span class="dv">4</span>)))</span>
<span id="cb55-6"><a href="#cb55-6" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb55-7"><a href="#cb55-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">par</span>(<span class="at">mfrow =</span> <span class="fu">c</span>(<span class="dv">2</span>,<span class="dv">1</span>))</span>
<span id="cb55-8"><a href="#cb55-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">acf</span>(ts_diff, <span class="at">main =</span> <span class="st">"ACF diferencované řady"</span>, <span class="at">lag.max =</span> <span class="dv">100</span>)</span>
<span id="cb55-9"><a href="#cb55-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pacf</span>(ts_diff, <span class="at">main =</span> <span class="st">"PACF diferencované řady"</span>, <span class="at">lag.max =</span> <span class="dv">100</span>)</span>
<span id="cb55-10"><a href="#cb55-10" aria-hidden="true" tabindex="-1"></a>} <span class="cf">else</span> {</span>
<span id="cb55-11"><a href="#cb55-11" aria-hidden="true" tabindex="-1"></a>  ts_diff <span class="ot">&lt;-</span> ts_data</span>
<span id="cb55-12"><a href="#cb55-12" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Data nevykazují silnou závislost na minulých hodnotách (kromě jedné slabé záporné na lag 1). To by mohlo znamenat, že jednoduchý model (např. jen AR(1) nebo dokonce obyčejný průměr) už bude docela dostačující.</p>
</section>
<section id="testování-sarima-kombinací" class="level4">
<h4 class="anchored" data-anchor-id="testování-sarima-kombinací">Testování SARIMA kombinací</h4>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb56"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb56-1"><a href="#cb56-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"Hledání vhodné SARIMA kombinace...</span><span class="sc">\n</span><span class="st">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Hledání vhodné SARIMA kombinace...</code></pre>
</div>
<div class="sourceCode cell-code" id="cb58"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb58-1"><a href="#cb58-1" aria-hidden="true" tabindex="-1"></a>(auto_sarima_a <span class="ot">&lt;-</span> <span class="fu">auto.arima</span>(ts_log, <span class="at">seasonal =</span> <span class="cn">TRUE</span>)) <span class="co">#sezonní diference Zt = 0.004 + 0156*Zt-1 + 0.09*Et-1 + 0.11*Et-2 - 0.53Zt-1</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Series: ts_log 
ARIMA(5,2,1) 

Coefficients:
         ar1     ar2      ar3      ar4     ar5      ma1
      0.0981  0.2600  -0.1673  -0.2956  0.0421  -0.8147
s.e.  0.1112  0.0886   0.0757   0.0830  0.0951   0.0881

sigma^2 = 0.1274:  log likelihood = -90.24
AIC=194.48   AICc=194.97   BIC=218.79</code></pre>
</div>
<div class="sourceCode cell-code" id="cb60"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb60-1"><a href="#cb60-1" aria-hidden="true" tabindex="-1"></a><span class="fu">BIC</span>(auto_sarima_a)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 218.7859</code></pre>
</div>
<div class="sourceCode cell-code" id="cb62"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb62-1"><a href="#cb62-1" aria-hidden="true" tabindex="-1"></a><span class="co">#(auto_sarima_b &lt;- auto.arima(ts_data, ic = "bic"))</span></span>
<span id="cb62-2"><a href="#cb62-2" aria-hidden="true" tabindex="-1"></a>final_sarima <span class="ot">&lt;-</span> auto_sarima_a</span>
<span id="cb62-3"><a href="#cb62-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Diagnostika residuí</span></span>
<span id="cb62-4"><a href="#cb62-4" aria-hidden="true" tabindex="-1"></a><span class="fu">checkresiduals</span>(final_sarima)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="covid_data_analyse_files/figure-html/unnamed-chunk-11-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" width="6000"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>
    Ljung-Box test

data:  Residuals from ARIMA(5,2,1)
Q* = 47.075, df = 42, p-value = 0.2726

Model df: 6.   Total lags used: 48</code></pre>
</div>
</div>
<p>SARIMA model byl identifikován pomocí automatického vyhledávání. Model zachycuje jak autoregresní chování, tak sezónní komponenty. Diagnostika residuí ukazuje, zda jsou splněny předpoklady modelu.</p>
</section>
</section>
<section id="analýza-závislosti-na-jiných-řadách" class="level2">
<h2 class="anchored" data-anchor-id="analýza-závislosti-na-jiných-řadách">Analýza závislosti na jiných řadách</h2>
<p><strong>Křížová korelační funkce</strong> (CCF): Měří korelaci mezi dvěma časovými řadami při různých zpožděních</p>
<ul>
<li><p><strong>Pozitivní lag</strong>: Y předchází X (Y ovlivňuje budoucí hodnoty X)</p></li>
<li><p><strong>Negativní lag</strong>: X předchází Y (X ovlivňuje budoucí hodnoty Y) Zero lag: Současná korelace</p></li>
</ul>
<p><strong>Testované proměnné</strong>:</p>
<ul>
<li><p><strong>new_deaths</strong> - úmrtí (očekáváme zpoždění za případy)</p></li>
<li><p><strong>stringency_index</strong> - přísnost opatření (může předcházet změnám v případech)</p></li>
<li><p><strong>hosp_patients</strong> - hospitalizace (může následovat za případy)</p></li>
<li><p><strong>reproduction_rate</strong> - reprodukční číslo (může předcházet změnám)</p></li>
</ul>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb64"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb64-1"><a href="#cb64-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Příprava dalších časových řad</span></span>
<span id="cb64-2"><a href="#cb64-2" aria-hidden="true" tabindex="-1"></a>other_series <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"new_deaths"</span>, <span class="st">"stringency_index"</span>, <span class="st">"hosp_patients"</span>, <span class="st">"reproduction_rate"</span>)</span>
<span id="cb64-3"><a href="#cb64-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-4"><a href="#cb64-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Křížová korelace s různými zpožděními</span></span>
<span id="cb64-5"><a href="#cb64-5" aria-hidden="true" tabindex="-1"></a>ccf_results <span class="ot">&lt;-</span> <span class="fu">list</span>()</span>
<span id="cb64-6"><a href="#cb64-6" aria-hidden="true" tabindex="-1"></a>max_lag <span class="ot">&lt;-</span> <span class="dv">4</span></span>
<span id="cb64-7"><a href="#cb64-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-8"><a href="#cb64-8" aria-hidden="true" tabindex="-1"></a><span class="fu">par</span>(<span class="at">mfrow =</span> <span class="fu">c</span>(<span class="dv">2</span>,<span class="dv">2</span>))</span>
<span id="cb64-9"><a href="#cb64-9" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(other_series)) {</span>
<span id="cb64-10"><a href="#cb64-10" aria-hidden="true" tabindex="-1"></a>  y_var <span class="ot">&lt;-</span> data[[other_series[i]]]</span>
<span id="cb64-11"><a href="#cb64-11" aria-hidden="true" tabindex="-1"></a>  y_var <span class="ot">&lt;-</span> y_var[<span class="sc">!</span><span class="fu">is.na</span>(y_var)]</span>
<span id="cb64-12"><a href="#cb64-12" aria-hidden="true" tabindex="-1"></a>  x_var <span class="ot">&lt;-</span> data<span class="sc">$</span>new_cases[<span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(y_var)]</span>
<span id="cb64-13"><a href="#cb64-13" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb64-14"><a href="#cb64-14" aria-hidden="true" tabindex="-1"></a>  ccf_result <span class="ot">&lt;-</span> <span class="fu">ccf</span>(x_var, y_var, <span class="at">lag.max =</span> max_lag, </span>
<span id="cb64-15"><a href="#cb64-15" aria-hidden="true" tabindex="-1"></a>                    <span class="at">main =</span> <span class="fu">paste</span>(<span class="st">"CCF:"</span>, other_series[i]))</span>
<span id="cb64-16"><a href="#cb64-16" aria-hidden="true" tabindex="-1"></a>  ccf_results[[other_series[i]]] <span class="ot">&lt;-</span> ccf_result</span>
<span id="cb64-17"><a href="#cb64-17" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="covid_data_analyse_files/figure-html/unnamed-chunk-12-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" width="6000"></p>
</figure>
</div>
</div>
<div class="sourceCode cell-code" id="cb65"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb65-1"><a href="#cb65-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Identifikace významných korelací</span></span>
<span id="cb65-2"><a href="#cb65-2" aria-hidden="true" tabindex="-1"></a>significant_lags <span class="ot">&lt;-</span> <span class="fu">list</span>()</span>
<span id="cb65-3"><a href="#cb65-3" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span>(series <span class="cf">in</span> <span class="fu">names</span>(ccf_results)) {</span>
<span id="cb65-4"><a href="#cb65-4" aria-hidden="true" tabindex="-1"></a>  ccf_vals <span class="ot">&lt;-</span> ccf_results[[series]]<span class="sc">$</span>acf</span>
<span id="cb65-5"><a href="#cb65-5" aria-hidden="true" tabindex="-1"></a>  lags <span class="ot">&lt;-</span> ccf_results[[series]]<span class="sc">$</span>lag</span>
<span id="cb65-6"><a href="#cb65-6" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb65-7"><a href="#cb65-7" aria-hidden="true" tabindex="-1"></a>  <span class="co"># 95% interval spolehlivosti (přibližně)</span></span>
<span id="cb65-8"><a href="#cb65-8" aria-hidden="true" tabindex="-1"></a>  n <span class="ot">&lt;-</span> <span class="fu">length</span>(data<span class="sc">$</span>new_cases)</span>
<span id="cb65-9"><a href="#cb65-9" aria-hidden="true" tabindex="-1"></a>  ci <span class="ot">&lt;-</span> <span class="fl">1.96</span><span class="sc">/</span><span class="fu">sqrt</span>(n)</span>
<span id="cb65-10"><a href="#cb65-10" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb65-11"><a href="#cb65-11" aria-hidden="true" tabindex="-1"></a>  significant_idx <span class="ot">&lt;-</span> <span class="fu">which</span>(<span class="fu">abs</span>(ccf_vals) <span class="sc">&gt;</span> ci)</span>
<span id="cb65-12"><a href="#cb65-12" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span>(<span class="fu">length</span>(significant_idx) <span class="sc">&gt;</span> <span class="dv">0</span>) {</span>
<span id="cb65-13"><a href="#cb65-13" aria-hidden="true" tabindex="-1"></a>    significant_lags[[series]] <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(</span>
<span id="cb65-14"><a href="#cb65-14" aria-hidden="true" tabindex="-1"></a>      <span class="at">lag =</span> lags[significant_idx],</span>
<span id="cb65-15"><a href="#cb65-15" aria-hidden="true" tabindex="-1"></a>      <span class="at">correlation =</span> ccf_vals[significant_idx]</span>
<span id="cb65-16"><a href="#cb65-16" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb65-17"><a href="#cb65-17" aria-hidden="true" tabindex="-1"></a>    <span class="fu">print</span>(<span class="fu">paste</span>(<span class="st">"Významné korelace pro"</span>, series, <span class="st">":"</span>))</span>
<span id="cb65-18"><a href="#cb65-18" aria-hidden="true" tabindex="-1"></a>    <span class="fu">print</span>(<span class="fu">head</span>(significant_lags[[series]]))</span>
<span id="cb65-19"><a href="#cb65-19" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb65-20"><a href="#cb65-20" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "Významné korelace pro new_deaths :"
  lag correlation
1  -4   0.2794442
2  -3   0.3060717
3  -2   0.3411681
4  -1   0.3638755
5   0   0.3579043
6   1   0.3361211
[1] "Významné korelace pro stringency_index :"
  lag correlation
1  -4  -0.2102421
2  -3  -0.1803454
3  -2  -0.1517920
4  -1  -0.1423042
5   0  -0.1864738
6   1  -0.1753981
[1] "Významné korelace pro hosp_patients :"
  lag correlation
1  -4   0.1948951
2  -3   0.2191859
3  -2   0.2508956
4  -1   0.2945856
5   0   0.3488359
6   1   0.4025990
[1] "Významné korelace pro reproduction_rate :"
  lag correlation
1  -4  -0.2715935
2  -3  -0.2761924
3  -2  -0.2836062
4  -1  -0.3066550
5   0  -0.3408848
6   1  -0.3046825</code></pre>
</div>
</div>
</section>
<section id="výsledky" class="level2">
<h2 class="anchored" data-anchor-id="výsledky">Výsledky</h2>
<ul>
<li><strong>new_deaths × new_deaths</strong>
<ul>
<li>Korelace na lag 0 i ±1 je pozitivní a nad hranicí významnosti → úmrtí jsou silně závislá na předchozích hodnotách (autoregrese).</li>
<li>Dává smysl použít zpoždění <code>new_deaths</code> (např. lag 1) jako vysvětlující proměnnou.</li>
</ul></li>
<li><strong>new_deaths × stringency_index</strong>
<ul>
<li>Korelace je malá, téměř všechny sloupce v intervalu - vládní opatření (stringency_index) nemají okamžitou silnou lineární souvislost s denním počtem úmrtí v krátkém horizontu ±4 dní.</li>
</ul></li>
<li><strong>new_deaths × hosp_patients</strong>
<ul>
<li>Výrazně pozitivní korelace na lag 0 a kladných lagech - počet hospitalizovaných je dobrý prediktor úmrtí i pro několik následujících dní.</li>
<li>Určitě má smysl zahrnout hosp_patients (lag 0 nebo 1) do ARIMAX modelu.</li>
</ul></li>
<li><strong>new_deaths × reproduction_rate</strong>
<ul>
<li>Korelace je kolem nuly, uvnitř CI - reprodukční číslo v takto krátkém horizontu přímo neovlivňuje úmrtí (což dává smysl – efekt se projeví až po týdnech).</li>
</ul></li>
</ul>
</section>
<section id="optimální-model-s-externími-regresory-arimax-model" class="level2">
<h2 class="anchored" data-anchor-id="optimální-model-s-externími-regresory-arimax-model">Optimální model s externími regresory (ARIMAX model)</h2>
<p>Kombinace časové dynamiky ARIMA s vlivem externích faktorů. Arimax model zachycuje autokorelaci v datech a současně modeluje vliv dalších proměnných.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb67"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb67-1"><a href="#cb67-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Příprava zpožděných proměnných na základě CCF analýzy</span></span>
<span id="cb67-2"><a href="#cb67-2" aria-hidden="true" tabindex="-1"></a>data<span class="sc">$</span>deaths_lag <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="fu">rep</span>(<span class="cn">NA</span>, <span class="dv">1</span>), data<span class="sc">$</span>new_deaths[<span class="dv">1</span><span class="sc">:</span>(<span class="fu">nrow</span>(data)<span class="sc">-</span><span class="dv">1</span>)])</span>
<span id="cb67-3"><a href="#cb67-3" aria-hidden="true" tabindex="-1"></a>data<span class="sc">$</span>stringency_lag <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="fu">rep</span>(<span class="cn">NA</span>, <span class="dv">5</span>), data<span class="sc">$</span>stringency_index[<span class="dv">1</span><span class="sc">:</span>(<span class="fu">nrow</span>(data)<span class="sc">-</span><span class="dv">5</span>)])</span>
<span id="cb67-4"><a href="#cb67-4" aria-hidden="true" tabindex="-1"></a>data<span class="sc">$</span>hosp_lag <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="fu">rep</span>(<span class="cn">NA</span>, <span class="dv">2</span>), data<span class="sc">$</span>hosp_patients[<span class="dv">1</span><span class="sc">:</span>(<span class="fu">nrow</span>(data)<span class="sc">-</span><span class="dv">2</span>)])</span>
<span id="cb67-5"><a href="#cb67-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb67-6"><a href="#cb67-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Model s externími regresory</span></span>
<span id="cb67-7"><a href="#cb67-7" aria-hidden="true" tabindex="-1"></a>external_vars <span class="ot">&lt;-</span> <span class="fu">cbind</span>(</span>
<span id="cb67-8"><a href="#cb67-8" aria-hidden="true" tabindex="-1"></a>  <span class="at">deaths_lag =</span> data<span class="sc">$</span>deaths_lag,</span>
<span id="cb67-9"><a href="#cb67-9" aria-hidden="true" tabindex="-1"></a>  <span class="at">stringency_lag =</span> data<span class="sc">$</span>stringency_lag,</span>
<span id="cb67-10"><a href="#cb67-10" aria-hidden="true" tabindex="-1"></a>  <span class="at">hosp_lag =</span> data<span class="sc">$</span>hosp_lag</span>
<span id="cb67-11"><a href="#cb67-11" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb67-12"><a href="#cb67-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb67-13"><a href="#cb67-13" aria-hidden="true" tabindex="-1"></a><span class="co"># Odstranění NA hodnot</span></span>
<span id="cb67-14"><a href="#cb67-14" aria-hidden="true" tabindex="-1"></a>complete_idx <span class="ot">&lt;-</span> <span class="fu">complete.cases</span>(<span class="fu">cbind</span>(data<span class="sc">$</span>new_cases, external_vars))</span>
<span id="cb67-15"><a href="#cb67-15" aria-hidden="true" tabindex="-1"></a>ts_complete <span class="ot">&lt;-</span> <span class="fu">ts</span>(<span class="fu">log1p</span>(data<span class="sc">$</span>new_cases[complete_idx]), <span class="at">start =</span> <span class="fu">c</span>(start_year, start_week), <span class="at">frequency =</span> <span class="fl">52.18</span>)</span>
<span id="cb67-16"><a href="#cb67-16" aria-hidden="true" tabindex="-1"></a>external_complete <span class="ot">&lt;-</span> external_vars[complete_idx, ]</span>
<span id="cb67-17"><a href="#cb67-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb67-18"><a href="#cb67-18" aria-hidden="true" tabindex="-1"></a><span class="co"># ARIMAX model</span></span>
<span id="cb67-19"><a href="#cb67-19" aria-hidden="true" tabindex="-1"></a>arimax_model <span class="ot">&lt;-</span> <span class="fu">auto.arima</span>(ts_complete, <span class="at">xreg =</span> external_complete)</span>
<span id="cb67-20"><a href="#cb67-20" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(<span class="fu">summary</span>(arimax_model))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Series: ts_complete 
Regression with ARIMA(2,2,1) errors 

Coefficients:
         ar1      ar2      ma1  deaths_lag  stringency_lag  hosp_lag
      1.0762  -0.5043  -0.9492           0         -0.0037     1e-04
s.e.  0.1582   0.1023   0.0628           0          0.0052     6e-04

sigma^2 = 0.02408:  log likelihood = 69.18
AIC=-124.37   AICc=-123.58   BIC=-103.25

Training set error measures:
                      ME      RMSE       MAE        MPE      MAPE       MASE
Training set -0.02810517 0.1510578 0.0901144 -0.1772697 0.5483359 0.09463162
                   ACF1
Training set 0.01595567</code></pre>
</div>
<div class="sourceCode cell-code" id="cb69"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb69-1"><a href="#cb69-1" aria-hidden="true" tabindex="-1"></a><span class="fu">length</span>(<span class="fu">fitted</span>(arimax_model))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 153</code></pre>
</div>
<div class="sourceCode cell-code" id="cb71"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb71-1"><a href="#cb71-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Srovnání modelů</span></span>
<span id="cb71-2"><a href="#cb71-2" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"Srovnání všech modelů: </span><span class="sc">\n</span><span class="st">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Srovnání všech modelů: </code></pre>
</div>
<div class="sourceCode cell-code" id="cb73"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb73-1"><a href="#cb73-1" aria-hidden="true" tabindex="-1"></a>models_comparison <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(</span>
<span id="cb73-2"><a href="#cb73-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">Model =</span> <span class="fu">c</span>(<span class="st">"Funkční"</span>, <span class="st">"SARIMA"</span>, <span class="st">"ARIMAX"</span>),</span>
<span id="cb73-3"><a href="#cb73-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">AIC =</span> <span class="fu">c</span>(<span class="fu">AIC</span>(best_func_model), <span class="fu">AIC</span>(final_sarima), <span class="fu">AIC</span>(arimax_model)),</span>
<span id="cb73-4"><a href="#cb73-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">BIC =</span> <span class="fu">c</span>(<span class="fu">BIC</span>(best_func_model), <span class="fu">BIC</span>(final_sarima), <span class="fu">BIC</span>(arimax_model))</span>
<span id="cb73-5"><a href="#cb73-5" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb73-6"><a href="#cb73-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-7"><a href="#cb73-7" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(models_comparison)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>    Model       AIC       BIC
1 Funkční  796.9181  817.8019
2  SARIMA  194.4800  218.7859
3  ARIMAX -124.3671 -103.2461</code></pre>
</div>
</div>
<p>ARIMAX model kombinuje autoregresní chování s vlivem externích proměnných.</p>
<section id="kontrola-předpokladů-regresních-modelů" class="level4">
<h4 class="anchored" data-anchor-id="kontrola-předpokladů-regresních-modelů">Kontrola předpokladů regresních modelů</h4>
<p>Zde ověříme, zda naše modely splňují předpoklady, jako je nezávislost reziduí, heteroskedasticita (konstantní rozptyl), normalita reziduí a Ljung-Box test.</p>
<p><strong>Při porušení předpokladů se dělá:</strong></p>
<ul>
<li><p>Autokorelace - Zvýšení řádu ARIMA modelu.</p></li>
<li><p>Nenormalita - Transformace dat nebo robustní metody.</p></li>
<li><p>Heteroskedasticita - GARCH modely nebo weighted regression.</p></li>
</ul>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb75"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb75-1"><a href="#cb75-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Diagnostika residuí pro všechny modely</span></span>
<span id="cb75-2"><a href="#cb75-2" aria-hidden="true" tabindex="-1"></a>models_to_check <span class="ot">&lt;-</span> <span class="fu">list</span>(</span>
<span id="cb75-3"><a href="#cb75-3" aria-hidden="true" tabindex="-1"></a>  <span class="st">"Funkční"</span> <span class="ot">=</span> best_func_model,</span>
<span id="cb75-4"><a href="#cb75-4" aria-hidden="true" tabindex="-1"></a>  <span class="st">"SARIMA"</span> <span class="ot">=</span> final_sarima,</span>
<span id="cb75-5"><a href="#cb75-5" aria-hidden="true" tabindex="-1"></a>  <span class="st">"ARIMAX"</span> <span class="ot">=</span> arimax_model</span>
<span id="cb75-6"><a href="#cb75-6" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb75-7"><a href="#cb75-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb75-8"><a href="#cb75-8" aria-hidden="true" tabindex="-1"></a><span class="fu">par</span>(<span class="at">mfrow =</span> <span class="fu">c</span>(<span class="dv">2</span>,<span class="dv">2</span>))</span>
<span id="cb75-9"><a href="#cb75-9" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span>(model_name <span class="cf">in</span> <span class="fu">names</span>(models_to_check)) {</span>
<span id="cb75-10"><a href="#cb75-10" aria-hidden="true" tabindex="-1"></a>  model <span class="ot">&lt;-</span> models_to_check[[model_name]]</span>
<span id="cb75-11"><a href="#cb75-11" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb75-12"><a href="#cb75-12" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span>(<span class="fu">inherits</span>(model, <span class="st">"lm"</span>)) {</span>
<span id="cb75-13"><a href="#cb75-13" aria-hidden="true" tabindex="-1"></a>    residuals <span class="ot">&lt;-</span> <span class="fu">residuals</span>(model)</span>
<span id="cb75-14"><a href="#cb75-14" aria-hidden="true" tabindex="-1"></a>  } <span class="cf">else</span> {</span>
<span id="cb75-15"><a href="#cb75-15" aria-hidden="true" tabindex="-1"></a>    residuals <span class="ot">&lt;-</span> <span class="fu">residuals</span>(model)</span>
<span id="cb75-16"><a href="#cb75-16" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb75-17"><a href="#cb75-17" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb75-18"><a href="#cb75-18" aria-hidden="true" tabindex="-1"></a>  <span class="co"># ACF residuí</span></span>
<span id="cb75-19"><a href="#cb75-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">acf</span>(residuals, <span class="at">main =</span> <span class="fu">paste</span>(<span class="st">"ACF residuí -"</span>, model_name), <span class="at">lag.max =</span> <span class="dv">50</span>)</span>
<span id="cb75-20"><a href="#cb75-20" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Ljung-Box test</span></span>
<span id="cb75-21"><a href="#cb75-21" aria-hidden="true" tabindex="-1"></a>  lb_test <span class="ot">&lt;-</span> <span class="fu">Box.test</span>(residuals, <span class="at">lag =</span> <span class="dv">20</span>, <span class="at">type =</span> <span class="st">"Ljung-Box"</span>)</span>
<span id="cb75-22"><a href="#cb75-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">print</span>(<span class="fu">paste</span>(model_name, <span class="st">"- Ljung-Box test p-hodnota:"</span>, <span class="fu">round</span>(lb_test<span class="sc">$</span>p.value, <span class="dv">4</span>)))</span>
<span id="cb75-23"><a href="#cb75-23" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Normalita residuí</span></span>
<span id="cb75-24"><a href="#cb75-24" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb75-25"><a href="#cb75-25" aria-hidden="true" tabindex="-1"></a>shapiro_test <span class="ot">&lt;-</span> <span class="fu">shapiro.test</span>(<span class="fu">sample</span>(residuals, <span class="fu">min</span>(<span class="dv">5000</span>, <span class="fu">length</span>(residuals))))</span>
<span id="cb75-26"><a href="#cb75-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb75-27"><a href="#cb75-27" aria-hidden="true" tabindex="-1"></a>  <span class="fu">print</span>(<span class="fu">paste</span>(model_name, <span class="st">"- Shapiro test p-hodnota:"</span>, <span class="fu">round</span>(shapiro_test<span class="sc">$</span>p.value, <span class="dv">4</span>)))</span>
<span id="cb75-28"><a href="#cb75-28" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "Funkční - Ljung-Box test p-hodnota: 0"
[1] "Funkční - Shapiro test p-hodnota: 0"</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "SARIMA - Ljung-Box test p-hodnota: 0.2675"
[1] "SARIMA - Shapiro test p-hodnota: 0"</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "ARIMAX - Ljung-Box test p-hodnota: 0.4695"
[1] "ARIMAX - Shapiro test p-hodnota: 0"</code></pre>
</div>
<div class="sourceCode cell-code" id="cb79"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb79-1"><a href="#cb79-1" aria-hidden="true" tabindex="-1"></a><span class="co"># QQ plots pro normalitu</span></span>
<span id="cb79-2"><a href="#cb79-2" aria-hidden="true" tabindex="-1"></a><span class="fu">par</span>(<span class="at">mfrow =</span> <span class="fu">c</span>(<span class="dv">2</span>,<span class="dv">2</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="covid_data_analyse_files/figure-html/unnamed-chunk-14-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" width="6000"></p>
</figure>
</div>
</div>
<div class="sourceCode cell-code" id="cb80"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb80-1"><a href="#cb80-1" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span>(model_name <span class="cf">in</span> <span class="fu">names</span>(models_to_check)) {</span>
<span id="cb80-2"><a href="#cb80-2" aria-hidden="true" tabindex="-1"></a>  model <span class="ot">&lt;-</span> models_to_check[[model_name]]</span>
<span id="cb80-3"><a href="#cb80-3" aria-hidden="true" tabindex="-1"></a>  residuals <span class="ot">&lt;-</span> <span class="fu">residuals</span>(model)</span>
<span id="cb80-4"><a href="#cb80-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">qqnorm</span>(residuals, <span class="at">main =</span> <span class="fu">paste</span>(<span class="st">"Q-Q plot -"</span>, model_name))</span>
<span id="cb80-5"><a href="#cb80-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">qqline</span>(residuals)</span>
<span id="cb80-6"><a href="#cb80-6" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="covid_data_analyse_files/figure-html/unnamed-chunk-14-2.png" class="img-fluid quarto-figure quarto-figure-center figure-img" width="6000"></p>
</figure>
</div>
</div>
</div>
<p>Kontrola ukazuje, zda jsou splněny základní předpoklady modelů - nezávislost residuí (ACF, Ljung-Box test) a jejich normalita (Shapiro test, Q-Q ploty).</p>
</section>
</section>
<section id="predikce-budoucích-hodnot" class="level2">
<h2 class="anchored" data-anchor-id="predikce-budoucích-hodnot">Predikce budoucích hodnot</h2>
<p>Zde otestujeme predikční schopnost jednotlivých modelů a porovnáme jejich výkon na 10 období do budoucna.</p>
<p>Srovnáme Funkční model, SARIMA model a ARIMAX model. Vytvoříme Grafické srovnání modelů a kvantitativní hodnocení.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb81"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb81-1"><a href="#cb81-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Predikce na 10 období dopředu</span></span>
<span id="cb81-2"><a href="#cb81-2" aria-hidden="true" tabindex="-1"></a>horizon <span class="ot">&lt;-</span> <span class="dv">10</span></span>
<span id="cb81-3"><a href="#cb81-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Kontrola kvality modelů před predikcí</span></span>
<span id="cb81-4"><a href="#cb81-4" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"Kontrola SARIMA modelu:</span><span class="sc">\n</span><span class="st">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Kontrola SARIMA modelu:</code></pre>
</div>
<div class="sourceCode cell-code" id="cb83"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb83-1"><a href="#cb83-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"Koeficienty:"</span>, <span class="fu">coef</span>(final_sarima), <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Koeficienty: 0.09810039 0.2600491 -0.167323 -0.2955668 0.04207178 -0.8146651 </code></pre>
</div>
<div class="sourceCode cell-code" id="cb85"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb85-1"><a href="#cb85-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"Sigma2:"</span>, final_sarima<span class="sc">$</span>sigma2, <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Sigma2: 0.1273808 </code></pre>
</div>
<div class="sourceCode cell-code" id="cb87"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb87-1"><a href="#cb87-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"Loglik:"</span>, final_sarima<span class="sc">$</span>loglik, <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Loglik: -90.24 </code></pre>
</div>
<div class="sourceCode cell-code" id="cb89"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb89-1"><a href="#cb89-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Kontrola časové řady</span></span>
<span id="cb89-2"><a href="#cb89-2" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"</span><span class="sc">\n</span><span class="st">Kontrola časové řady pro predikci:</span><span class="sc">\n</span><span class="st">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Kontrola časové řady pro predikci:</code></pre>
</div>
<div class="sourceCode cell-code" id="cb91"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb91-1"><a href="#cb91-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"Délka:"</span>, <span class="fu">length</span>(ts_data), <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Délka: 240 </code></pre>
</div>
<div class="sourceCode cell-code" id="cb93"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb93-1"><a href="#cb93-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"Start:"</span>, <span class="fu">paste</span>(<span class="fu">start</span>(ts_data), <span class="at">collapse =</span> <span class="st">", "</span>), <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Start: 2020.01916443082 </code></pre>
</div>
<div class="sourceCode cell-code" id="cb95"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb95-1"><a href="#cb95-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"Frequency:"</span>, <span class="fu">frequency</span>(ts_data), <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Frequency: 52.18 </code></pre>
</div>
<div class="sourceCode cell-code" id="cb97"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb97-1"><a href="#cb97-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"Posledních 5 hodnot:"</span>, <span class="fu">tail</span>(ts_data, <span class="dv">5</span>), <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Posledních 5 hodnot: 205046 207990 236364 257506 214317 </code></pre>
</div>
<div class="sourceCode cell-code" id="cb99"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb99-1"><a href="#cb99-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Funkční model predikce</span></span>
<span id="cb99-2"><a href="#cb99-2" aria-hidden="true" tabindex="-1"></a>future_t <span class="ot">&lt;-</span> (<span class="fu">nrow</span>(data)<span class="sc">+</span><span class="dv">1</span>)<span class="sc">:</span>(<span class="fu">nrow</span>(data)<span class="sc">+</span>horizon)</span>
<span id="cb99-3"><a href="#cb99-3" aria-hidden="true" tabindex="-1"></a>future_data <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(</span>
<span id="cb99-4"><a href="#cb99-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">t =</span> future_t,</span>
<span id="cb99-5"><a href="#cb99-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">sin_365 =</span> <span class="fu">sin</span>(<span class="dv">2</span> <span class="sc">*</span> pi <span class="sc">*</span> future_t <span class="sc">/</span> <span class="fl">52.18</span>),</span>
<span id="cb99-6"><a href="#cb99-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">cos_365 =</span> <span class="fu">cos</span>(<span class="dv">2</span> <span class="sc">*</span> pi <span class="sc">*</span> future_t <span class="sc">/</span> <span class="fl">52.18</span>),</span>
<span id="cb99-7"><a href="#cb99-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">sin_7 =</span> <span class="fu">sin</span>(<span class="dv">2</span> <span class="sc">*</span> pi <span class="sc">*</span> future_t <span class="sc">/</span> <span class="dv">1</span>),</span>
<span id="cb99-8"><a href="#cb99-8" aria-hidden="true" tabindex="-1"></a>  <span class="at">cos_7 =</span> <span class="fu">cos</span>(<span class="dv">2</span> <span class="sc">*</span> pi <span class="sc">*</span> future_t <span class="sc">/</span> <span class="dv">1</span>)</span>
<span id="cb99-9"><a href="#cb99-9" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb99-10"><a href="#cb99-10" aria-hidden="true" tabindex="-1"></a><span class="co"># Jednoduchá predikce bez složitého rozlišování modelů</span></span>
<span id="cb99-11"><a href="#cb99-11" aria-hidden="true" tabindex="-1"></a>pred_func <span class="ot">&lt;-</span> <span class="fu">predict</span>(best_func_model, <span class="at">newdata =</span> future_data, <span class="at">interval =</span> <span class="st">"prediction"</span>)</span>
<span id="cb99-12"><a href="#cb99-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb99-13"><a href="#cb99-13" aria-hidden="true" tabindex="-1"></a><span class="co"># zpět na původní škálu</span></span>
<span id="cb99-14"><a href="#cb99-14" aria-hidden="true" tabindex="-1"></a>pred_func <span class="ot">&lt;-</span> <span class="fu">expm1</span>(pred_func)</span>
<span id="cb99-15"><a href="#cb99-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb99-16"><a href="#cb99-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb99-17"><a href="#cb99-17" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"Funkční model - predikce dokončena</span><span class="sc">\n</span><span class="st">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Funkční model - predikce dokončena</code></pre>
</div>
<div class="sourceCode cell-code" id="cb101"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb101-1"><a href="#cb101-1" aria-hidden="true" tabindex="-1"></a><span class="co"># SARIMA predikce</span></span>
<span id="cb101-2"><a href="#cb101-2" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span>(<span class="fu">is.null</span>(final_sarima) <span class="sc">||</span> <span class="fu">any</span>(<span class="fu">is.na</span>(<span class="fu">coef</span>(final_sarima)))) {</span>
<span id="cb101-3"><a href="#cb101-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">cat</span>(<span class="st">"SARIMA model je nevalidní! Vytvářím nový jednoduchý model...</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb101-4"><a href="#cb101-4" aria-hidden="true" tabindex="-1"></a>  simple_ts <span class="ot">&lt;-</span> <span class="fu">ts</span>(data<span class="sc">$</span>new_cases[<span class="sc">!</span><span class="fu">is.na</span>(data<span class="sc">$</span>new_cases)], <span class="at">frequency =</span> <span class="dv">1</span>)</span>
<span id="cb101-5"><a href="#cb101-5" aria-hidden="true" tabindex="-1"></a>  final_sarima <span class="ot">&lt;-</span> <span class="fu">tryCatch</span>({</span>
<span id="cb101-6"><a href="#cb101-6" aria-hidden="true" tabindex="-1"></a>    <span class="fu">arima</span>(simple_ts, <span class="at">order =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">1</span>))</span>
<span id="cb101-7"><a href="#cb101-7" aria-hidden="true" tabindex="-1"></a>  }, <span class="at">error =</span> <span class="cf">function</span>(e) {</span>
<span id="cb101-8"><a href="#cb101-8" aria-hidden="true" tabindex="-1"></a>    <span class="fu">cat</span>(<span class="st">"I jednoduchý ARIMA selhal:"</span>, e<span class="sc">$</span>message, <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb101-9"><a href="#cb101-9" aria-hidden="true" tabindex="-1"></a>    <span class="fu">arima</span>(simple_ts, <span class="at">order =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">1</span>, <span class="dv">0</span>))  <span class="co"># random walk</span></span>
<span id="cb101-10"><a href="#cb101-10" aria-hidden="true" tabindex="-1"></a>  })</span>
<span id="cb101-11"><a href="#cb101-11" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb101-12"><a href="#cb101-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb101-13"><a href="#cb101-13" aria-hidden="true" tabindex="-1"></a>pred_sarima <span class="ot">&lt;-</span> <span class="fu">forecast</span>(final_sarima, <span class="at">h =</span> horizon)</span>
<span id="cb101-14"><a href="#cb101-14" aria-hidden="true" tabindex="-1"></a><span class="fu">autoplot</span>(pred_sarima)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="covid_data_analyse_files/figure-html/unnamed-chunk-15-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" width="6000"></p>
</figure>
</div>
</div>
<div class="sourceCode cell-code" id="cb102"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb102-1"><a href="#cb102-1" aria-hidden="true" tabindex="-1"></a><span class="do">## zpětný převod na původní škálu</span></span>
<span id="cb102-2"><a href="#cb102-2" aria-hidden="true" tabindex="-1"></a>pred_sarima<span class="sc">$</span>mean  <span class="ot">&lt;-</span> <span class="fu">expm1</span>(pred_sarima<span class="sc">$</span>mean)</span>
<span id="cb102-3"><a href="#cb102-3" aria-hidden="true" tabindex="-1"></a>pred_sarima<span class="sc">$</span>lower <span class="ot">&lt;-</span> <span class="fu">expm1</span>(pred_sarima<span class="sc">$</span>lower)</span>
<span id="cb102-4"><a href="#cb102-4" aria-hidden="true" tabindex="-1"></a>pred_sarima<span class="sc">$</span>upper <span class="ot">&lt;-</span> <span class="fu">expm1</span>(pred_sarima<span class="sc">$</span>upper)</span>
<span id="cb102-5"><a href="#cb102-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-6"><a href="#cb102-6" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"SARIMA predikce dokončena</span><span class="sc">\n</span><span class="st">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>SARIMA predikce dokončena</code></pre>
</div>
<div class="sourceCode cell-code" id="cb104"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb104-1"><a href="#cb104-1" aria-hidden="true" tabindex="-1"></a><span class="co"># ARIMAX predikce (potřebujeme budoucí hodnoty externích proměnných)</span></span>
<span id="cb104-2"><a href="#cb104-2" aria-hidden="true" tabindex="-1"></a><span class="co"># Pro zjednodušení použijeme poslední dostupné hodnoty</span></span>
<span id="cb104-3"><a href="#cb104-3" aria-hidden="true" tabindex="-1"></a>last_external <span class="ot">&lt;-</span> external_complete[<span class="fu">nrow</span>(external_complete), , drop <span class="ot">=</span> <span class="cn">FALSE</span>]</span>
<span id="cb104-4"><a href="#cb104-4" aria-hidden="true" tabindex="-1"></a>future_external <span class="ot">&lt;-</span> <span class="fu">matrix</span>(<span class="fu">rep</span>(<span class="fu">as.numeric</span>(last_external), horizon), <span class="at">nrow =</span> horizon, <span class="at">byrow =</span> <span class="cn">TRUE</span>)</span>
<span id="cb104-5"><a href="#cb104-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb104-6"><a href="#cb104-6" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(future_external) <span class="ot">&lt;-</span> <span class="fu">colnames</span>(external_complete)</span>
<span id="cb104-7"><a href="#cb104-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb104-8"><a href="#cb104-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb104-9"><a href="#cb104-9" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"Názvy sloupců v trénovacích datech:"</span>, <span class="fu">colnames</span>(external_complete), <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Názvy sloupců v trénovacích datech: deaths_lag stringency_lag hosp_lag </code></pre>
</div>
<div class="sourceCode cell-code" id="cb106"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb106-1"><a href="#cb106-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"Názvy sloupců v predikčních datech:"</span>, <span class="fu">colnames</span>(future_external), <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Názvy sloupců v predikčních datech: deaths_lag stringency_lag hosp_lag </code></pre>
</div>
<div class="sourceCode cell-code" id="cb108"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb108-1"><a href="#cb108-1" aria-hidden="true" tabindex="-1"></a>pred_arimax <span class="ot">=</span> <span class="fu">forecast</span>(arimax_model, <span class="at">xreg =</span> future_external, <span class="at">h =</span> horizon)</span>
<span id="cb108-2"><a href="#cb108-2" aria-hidden="true" tabindex="-1"></a><span class="fu">autoplot</span>(pred_arimax)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="covid_data_analyse_files/figure-html/unnamed-chunk-15-2.png" class="img-fluid quarto-figure quarto-figure-center figure-img" width="6000"></p>
</figure>
</div>
</div>
<div class="sourceCode cell-code" id="cb109"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb109-1"><a href="#cb109-1" aria-hidden="true" tabindex="-1"></a><span class="co"># zpět na původní škálu</span></span>
<span id="cb109-2"><a href="#cb109-2" aria-hidden="true" tabindex="-1"></a>pred_arimax<span class="sc">$</span>mean  <span class="ot">&lt;-</span> <span class="fu">expm1</span>(pred_arimax<span class="sc">$</span>mean)</span>
<span id="cb109-3"><a href="#cb109-3" aria-hidden="true" tabindex="-1"></a>pred_arimax<span class="sc">$</span>lower <span class="ot">&lt;-</span> <span class="fu">expm1</span>(pred_arimax<span class="sc">$</span>lower)</span>
<span id="cb109-4"><a href="#cb109-4" aria-hidden="true" tabindex="-1"></a>pred_arimax<span class="sc">$</span>upper <span class="ot">&lt;-</span> <span class="fu">expm1</span>(pred_arimax<span class="sc">$</span>upper)</span>
<span id="cb109-5"><a href="#cb109-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb109-6"><a href="#cb109-6" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"ARIMAX predikce dokončena</span><span class="sc">\n</span><span class="st">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>ARIMAX predikce dokončena</code></pre>
</div>
</div>
<p><img src="http://127.0.0.1:20303/chunk_output/s/B26260BB/cll3y3e8jgixb/00001c.png" class="img-fluid"></p>
<section id="grafické-srovnání-a-hodnocení-modelů" class="level4">
<h4 class="anchored" data-anchor-id="grafické-srovnání-a-hodnocení-modelů">Grafické srovnání a hodnocení modelů</h4>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb111"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb111-1"><a href="#cb111-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Grafické zobrazení predikcí</span></span>
<span id="cb111-2"><a href="#cb111-2" aria-hidden="true" tabindex="-1"></a>future_dates <span class="ot">&lt;-</span> <span class="fu">seq</span>(<span class="fu">max</span>(data<span class="sc">$</span>date) <span class="sc">+</span> <span class="dv">7</span>, <span class="at">by =</span> <span class="st">"week"</span>, <span class="at">length.out =</span> horizon)</span>
<span id="cb111-3"><a href="#cb111-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb111-4"><a href="#cb111-4" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"Budoucí data:"</span>, <span class="fu">as.character</span>(future_dates[<span class="dv">1</span><span class="sc">:</span><span class="dv">3</span>]), <span class="st">"...</span><span class="sc">\n</span><span class="st">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Budoucí data: 2024-08-11 2024-08-18 2024-08-25 ...</code></pre>
</div>
<div class="sourceCode cell-code" id="cb113"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb113-1"><a href="#cb113-1" aria-hidden="true" tabindex="-1"></a><span class="co"># === KONTROLA PŘED GRAFEM ===</span></span>
<span id="cb113-2"><a href="#cb113-2" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"</span><span class="sc">\n</span><span class="st">=== FINÁLNÍ KONTROLA ===</span><span class="sc">\n</span><span class="st">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
=== FINÁLNÍ KONTROLA ===</code></pre>
</div>
<div class="sourceCode cell-code" id="cb115"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb115-1"><a href="#cb115-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"Funkční - rozsah:"</span>, <span class="fu">range</span>(pred_func[,<span class="dv">1</span>]), <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Funkční - rozsah: 10968.32 32825.11 </code></pre>
</div>
<div class="sourceCode cell-code" id="cb117"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb117-1"><a href="#cb117-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"SARIMA - rozsah:"</span>, <span class="fu">range</span>(pred_sarima<span class="sc">$</span>mean), <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>SARIMA - rozsah: 193293.8 222159.6 </code></pre>
</div>
<div class="sourceCode cell-code" id="cb119"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb119-1"><a href="#cb119-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"ARIMAX - rozsah:"</span>, <span class="fu">range</span>(pred_arimax<span class="sc">$</span>mean), <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>ARIMAX - rozsah: 4321477 6116011 </code></pre>
</div>
<div class="sourceCode cell-code" id="cb121"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb121-1"><a href="#cb121-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Test na nuly</span></span>
<span id="cb121-2"><a href="#cb121-2" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span>(<span class="fu">all</span>(pred_sarima<span class="sc">$</span>mean <span class="sc">==</span> <span class="dv">0</span>)) {</span>
<span id="cb121-3"><a href="#cb121-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">cat</span>(<span class="st">"PROBLÉM: SARIMA predikuje samé nuly!</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb121-4"><a href="#cb121-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">cat</span>(<span class="st">"Poslední hodnota v časové řadě:"</span>, <span class="fu">tail</span>(<span class="fu">as.numeric</span>(ts_data), <span class="dv">1</span>), <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb121-5"><a href="#cb121-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">cat</span>(<span class="st">"Model summary:</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb121-6"><a href="#cb121-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">print</span>(<span class="fu">summary</span>(final_sarima))</span>
<span id="cb121-7"><a href="#cb121-7" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Oprava: použij poslední hodnotu</span></span>
<span id="cb121-8"><a href="#cb121-8" aria-hidden="true" tabindex="-1"></a>  pred_sarima<span class="sc">$</span>mean <span class="ot">&lt;-</span> <span class="fu">rep</span>(<span class="fu">tail</span>(<span class="fu">as.numeric</span>(ts_weekly_data), <span class="dv">1</span>), horizon)</span>
<span id="cb121-9"><a href="#cb121-9" aria-hidden="true" tabindex="-1"></a>  pred_sarima<span class="sc">$</span>lower[,<span class="dv">2</span>] <span class="ot">&lt;-</span> pred_sarima<span class="sc">$</span>mean <span class="sc">*</span> <span class="fl">0.8</span></span>
<span id="cb121-10"><a href="#cb121-10" aria-hidden="true" tabindex="-1"></a>  pred_sarima<span class="sc">$</span>upper[,<span class="dv">2</span>] <span class="ot">&lt;-</span> pred_sarima<span class="sc">$</span>mean <span class="sc">*</span> <span class="fl">1.2</span></span>
<span id="cb121-11"><a href="#cb121-11" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb121-12"><a href="#cb121-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb121-13"><a href="#cb121-13" aria-hidden="true" tabindex="-1"></a><span class="co"># Určíme počet historických pozorování k zobrazení (posledních 24 měsíců nebo méně)</span></span>
<span id="cb121-14"><a href="#cb121-14" aria-hidden="true" tabindex="-1"></a>last_n_obs <span class="ot">&lt;-</span> <span class="dv">50</span></span>
<span id="cb121-15"><a href="#cb121-15" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"Zobrazím posledních"</span>, last_n_obs, <span class="st">"měsíčních pozorování</span><span class="sc">\n</span><span class="st">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Zobrazím posledních 50 měsíčních pozorování</code></pre>
</div>
<div class="sourceCode cell-code" id="cb123"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb123-1"><a href="#cb123-1" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span>(<span class="fu">nrow</span>(data) <span class="sc">&lt;</span> last_n_obs) last_n_obs <span class="ot">&lt;-</span> <span class="fu">nrow</span>(data);</span>
<span id="cb123-2"><a href="#cb123-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb123-3"><a href="#cb123-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Historická data</span></span>
<span id="cb123-4"><a href="#cb123-4" aria-hidden="true" tabindex="-1"></a>historical_dates <span class="ot">&lt;-</span> <span class="fu">tail</span>(data<span class="sc">$</span>date, last_n_obs)</span>
<span id="cb123-5"><a href="#cb123-5" aria-hidden="true" tabindex="-1"></a>historical_values <span class="ot">&lt;-</span> <span class="fu">tail</span>(data<span class="sc">$</span>new_cases, last_n_obs)</span>
<span id="cb123-6"><a href="#cb123-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb123-7"><a href="#cb123-7" aria-hidden="true" tabindex="-1"></a><span class="co">#Kontrola, že predikce mají správnou délku a nejsou NA </span></span>
<span id="cb123-8"><a href="#cb123-8" aria-hidden="true" tabindex="-1"></a>pred_func_clean <span class="ot">&lt;-</span> pred_func[,<span class="dv">1</span>] </span>
<span id="cb123-9"><a href="#cb123-9" aria-hidden="true" tabindex="-1"></a>pred_func_lower <span class="ot">&lt;-</span> pred_func[,<span class="dv">2</span>] </span>
<span id="cb123-10"><a href="#cb123-10" aria-hidden="true" tabindex="-1"></a>pred_func_upper <span class="ot">&lt;-</span> pred_func[,<span class="dv">3</span>] </span>
<span id="cb123-11"><a href="#cb123-11" aria-hidden="true" tabindex="-1"></a>pred_sarima_clean <span class="ot">&lt;-</span> pred_sarima<span class="sc">$</span>mean</span>
<span id="cb123-12"><a href="#cb123-12" aria-hidden="true" tabindex="-1"></a>pred_sarima_lower <span class="ot">&lt;-</span> pred_sarima<span class="sc">$</span>lower[,<span class="dv">2</span>]</span>
<span id="cb123-13"><a href="#cb123-13" aria-hidden="true" tabindex="-1"></a>pred_sarima_upper <span class="ot">&lt;-</span> pred_sarima<span class="sc">$</span>upper[,<span class="dv">2</span>]</span>
<span id="cb123-14"><a href="#cb123-14" aria-hidden="true" tabindex="-1"></a>pred_arimax_clean <span class="ot">&lt;-</span> pred_arimax<span class="sc">$</span>mean</span>
<span id="cb123-15"><a href="#cb123-15" aria-hidden="true" tabindex="-1"></a>pred_arimax_lower <span class="ot">&lt;-</span> pred_arimax<span class="sc">$</span>lower[,<span class="dv">2</span>]</span>
<span id="cb123-16"><a href="#cb123-16" aria-hidden="true" tabindex="-1"></a>pred_arimax_upper <span class="ot">&lt;-</span> pred_arimax<span class="sc">$</span>upper[,<span class="dv">2</span>]</span>
<span id="cb123-17"><a href="#cb123-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb123-18"><a href="#cb123-18" aria-hidden="true" tabindex="-1"></a><span class="co"># Náhrada NA hodnotami z SARIMA predikce pokud je potřeba </span></span>
<span id="cb123-19"><a href="#cb123-19" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span>(<span class="fu">any</span>(<span class="fu">is.na</span>(pred_func_clean))) { </span>
<span id="cb123-20"><a href="#cb123-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">cat</span>(<span class="st">"Opravuji NA v funkčních predikcích</span><span class="sc">\n</span><span class="st">"</span>) </span>
<span id="cb123-21"><a href="#cb123-21" aria-hidden="true" tabindex="-1"></a>  pred_func_clean[<span class="fu">is.na</span>(pred_func_clean)] <span class="ot">&lt;-</span> pred_sarima<span class="sc">$</span>mean[<span class="fu">is.na</span>(pred_func_clean)]</span>
<span id="cb123-22"><a href="#cb123-22" aria-hidden="true" tabindex="-1"></a>  pred_func_lower[<span class="fu">is.na</span>(pred_func_lower)] <span class="ot">&lt;-</span> pred_sarima<span class="sc">$</span>lower[<span class="fu">is.na</span>(pred_func_lower),<span class="dv">2</span>]</span>
<span id="cb123-23"><a href="#cb123-23" aria-hidden="true" tabindex="-1"></a>  pred_func_upper[<span class="fu">is.na</span>(pred_func_upper)] <span class="ot">&lt;-</span> pred_sarima<span class="sc">$</span>upper[<span class="fu">is.na</span>(pred_func_upper),<span class="dv">2</span>] </span>
<span id="cb123-24"><a href="#cb123-24" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb123-25"><a href="#cb123-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb123-26"><a href="#cb123-26" aria-hidden="true" tabindex="-1"></a><span class="co"># Vytvoření clean dat pro ggplot</span></span>
<span id="cb123-27"><a href="#cb123-27" aria-hidden="true" tabindex="-1"></a>plot_data_clean <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(</span>
<span id="cb123-28"><a href="#cb123-28" aria-hidden="true" tabindex="-1"></a>  <span class="at">date =</span> <span class="fu">c</span>(historical_dates, future_dates),</span>
<span id="cb123-29"><a href="#cb123-29" aria-hidden="true" tabindex="-1"></a>  <span class="at">actual =</span> <span class="fu">c</span>(historical_values, <span class="fu">rep</span>(<span class="cn">NA</span>, horizon)),</span>
<span id="cb123-30"><a href="#cb123-30" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Funkční model</span></span>
<span id="cb123-31"><a href="#cb123-31" aria-hidden="true" tabindex="-1"></a>  <span class="at">func_pred =</span> <span class="fu">c</span>(<span class="fu">rep</span>(<span class="cn">NA</span>, last_n_obs), <span class="fu">as.numeric</span>(pred_func_clean)),</span>
<span id="cb123-32"><a href="#cb123-32" aria-hidden="true" tabindex="-1"></a>  <span class="at">func_lower =</span> <span class="fu">c</span>(<span class="fu">rep</span>(<span class="cn">NA</span>, last_n_obs), <span class="fu">as.numeric</span>(pred_func_lower)),</span>
<span id="cb123-33"><a href="#cb123-33" aria-hidden="true" tabindex="-1"></a>  <span class="at">func_upper =</span> <span class="fu">c</span>(<span class="fu">rep</span>(<span class="cn">NA</span>, last_n_obs), <span class="fu">as.numeric</span>(pred_func_upper)),</span>
<span id="cb123-34"><a href="#cb123-34" aria-hidden="true" tabindex="-1"></a>  <span class="co"># SARIMA model  </span></span>
<span id="cb123-35"><a href="#cb123-35" aria-hidden="true" tabindex="-1"></a>  <span class="at">sarima_pred =</span> <span class="fu">c</span>(<span class="fu">rep</span>(<span class="cn">NA</span>, last_n_obs), <span class="fu">as.numeric</span>(pred_sarima<span class="sc">$</span>mean)),</span>
<span id="cb123-36"><a href="#cb123-36" aria-hidden="true" tabindex="-1"></a>  <span class="at">sarima_lower =</span> <span class="fu">c</span>(<span class="fu">rep</span>(<span class="cn">NA</span>, last_n_obs), <span class="fu">as.numeric</span>(pred_sarima<span class="sc">$</span>lower[,<span class="dv">2</span>])),</span>
<span id="cb123-37"><a href="#cb123-37" aria-hidden="true" tabindex="-1"></a>  <span class="at">sarima_upper =</span> <span class="fu">c</span>(<span class="fu">rep</span>(<span class="cn">NA</span>, last_n_obs), <span class="fu">as.numeric</span>(pred_sarima<span class="sc">$</span>upper[,<span class="dv">2</span>])),</span>
<span id="cb123-38"><a href="#cb123-38" aria-hidden="true" tabindex="-1"></a>  <span class="co"># ARIMAX model</span></span>
<span id="cb123-39"><a href="#cb123-39" aria-hidden="true" tabindex="-1"></a>  <span class="at">arimax_pred =</span> <span class="fu">c</span>(<span class="fu">rep</span>(<span class="cn">NA</span>, last_n_obs), <span class="fu">as.numeric</span>(pred_arimax<span class="sc">$</span>mean)),</span>
<span id="cb123-40"><a href="#cb123-40" aria-hidden="true" tabindex="-1"></a>  <span class="at">arimax_lower =</span> <span class="fu">c</span>(<span class="fu">rep</span>(<span class="cn">NA</span>, last_n_obs), <span class="fu">as.numeric</span>(pred_arimax<span class="sc">$</span>lower[,<span class="dv">2</span>])),</span>
<span id="cb123-41"><a href="#cb123-41" aria-hidden="true" tabindex="-1"></a>  <span class="at">arimax_upper =</span> <span class="fu">c</span>(<span class="fu">rep</span>(<span class="cn">NA</span>, last_n_obs), <span class="fu">as.numeric</span>(pred_arimax<span class="sc">$</span>upper[,<span class="dv">2</span>]))</span>
<span id="cb123-42"><a href="#cb123-42" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb123-43"><a href="#cb123-43" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb123-44"><a href="#cb123-44" aria-hidden="true" tabindex="-1"></a><span class="co"># Kontrola finálních dat</span></span>
<span id="cb123-45"><a href="#cb123-45" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"Kontrola plot_data_clean:</span><span class="sc">\n</span><span class="st">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Kontrola plot_data_clean:</code></pre>
</div>
<div class="sourceCode cell-code" id="cb125"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb125-1"><a href="#cb125-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"Počet řádků:"</span>, <span class="fu">nrow</span>(plot_data_clean), <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Počet řádků: 60 </code></pre>
</div>
<div class="sourceCode cell-code" id="cb127"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb127-1"><a href="#cb127-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"NA v actual:"</span>, <span class="fu">sum</span>(<span class="fu">is.na</span>(plot_data_clean<span class="sc">$</span>actual)), <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>NA v actual: 10 </code></pre>
</div>
<div class="sourceCode cell-code" id="cb129"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb129-1"><a href="#cb129-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"NA v func_pred:"</span>, <span class="fu">sum</span>(<span class="fu">is.na</span>(plot_data_clean<span class="sc">$</span>func_pred)), <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>NA v func_pred: 50 </code></pre>
</div>
<div class="sourceCode cell-code" id="cb131"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb131-1"><a href="#cb131-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"NA v sarima_pred:"</span>, <span class="fu">sum</span>(<span class="fu">is.na</span>(plot_data_clean<span class="sc">$</span>sarima_pred)), <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>NA v sarima_pred: 50 </code></pre>
</div>
<div class="sourceCode cell-code" id="cb133"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb133-1"><a href="#cb133-1" aria-hidden="true" tabindex="-1"></a>base_plot <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(plot_data_clean, <span class="fu">aes</span>(<span class="at">x =</span> date)) <span class="sc">+</span></span>
<span id="cb133-2"><a href="#cb133-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">y =</span> actual), <span class="at">color =</span> <span class="st">"black"</span>, <span class="at">size =</span> <span class="dv">1</span>, <span class="at">na.rm =</span> <span class="cn">TRUE</span>) <span class="sc">+</span></span>
<span id="cb133-3"><a href="#cb133-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">y =</span> actual), <span class="at">color =</span> <span class="st">"black"</span>, <span class="at">size =</span> <span class="fl">1.2</span>, <span class="at">na.rm =</span> <span class="cn">TRUE</span>) <span class="sc">+</span></span>
<span id="cb133-4"><a href="#cb133-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_vline</span>(<span class="at">xintercept =</span> <span class="fu">max</span>(historical_dates), <span class="at">linetype =</span> <span class="st">"dashed"</span>, <span class="at">alpha =</span> <span class="fl">0.7</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb134"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb134-1"><a href="#cb134-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Vylepšený graf predikcí</span></span>
<span id="cb134-2"><a href="#cb134-2" aria-hidden="true" tabindex="-1"></a>prediction_plot <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(plot_data_clean, <span class="fu">aes</span>(<span class="at">x =</span> date)) <span class="sc">+</span></span>
<span id="cb134-3"><a href="#cb134-3" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Historická data - body a čáry</span></span>
<span id="cb134-4"><a href="#cb134-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">y =</span> actual), <span class="at">color =</span> <span class="st">"black"</span>, <span class="at">size =</span> <span class="dv">1</span>, <span class="at">alpha =</span> <span class="fl">0.8</span>, <span class="at">na.rm =</span> <span class="cn">TRUE</span>) <span class="sc">+</span></span>
<span id="cb134-5"><a href="#cb134-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">y =</span> actual), <span class="at">color =</span> <span class="st">"black"</span>, <span class="at">size =</span> <span class="fl">1.2</span>, <span class="at">alpha =</span> <span class="fl">0.7</span>, <span class="at">na.rm =</span> <span class="cn">TRUE</span>) <span class="sc">+</span></span>
<span id="cb134-6"><a href="#cb134-6" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Funkční model</span></span>
<span id="cb134-7"><a href="#cb134-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">y =</span> func_pred), <span class="at">color =</span> <span class="st">"red"</span>, <span class="at">size =</span> <span class="dv">1</span>, <span class="at">na.rm =</span> <span class="cn">TRUE</span>) <span class="sc">+</span></span>
<span id="cb134-8"><a href="#cb134-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">y =</span> func_pred), <span class="at">color =</span> <span class="st">"red"</span>, <span class="at">size =</span> <span class="fl">1.2</span>, <span class="at">na.rm =</span> <span class="cn">TRUE</span>) <span class="sc">+</span></span>
<span id="cb134-9"><a href="#cb134-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_ribbon</span>(<span class="fu">aes</span>(<span class="at">ymin =</span> func_lower, <span class="at">ymax =</span> func_upper), <span class="at">fill =</span> <span class="st">"red"</span>, <span class="at">alpha =</span> <span class="fl">0.2</span>, <span class="at">na.rm =</span> <span class="cn">TRUE</span>) <span class="sc">+</span></span>
<span id="cb134-10"><a href="#cb134-10" aria-hidden="true" tabindex="-1"></a>  <span class="co"># SARIMA model</span></span>
<span id="cb134-11"><a href="#cb134-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">y =</span> sarima_pred), <span class="at">color =</span> <span class="st">"blue"</span>, <span class="at">size =</span> <span class="dv">1</span>, <span class="at">na.rm =</span> <span class="cn">TRUE</span>) <span class="sc">+</span></span>
<span id="cb134-12"><a href="#cb134-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">y =</span> sarima_pred), <span class="at">color =</span> <span class="st">"blue"</span>, <span class="at">size =</span> <span class="fl">1.2</span>, <span class="at">na.rm =</span> <span class="cn">TRUE</span>) <span class="sc">+</span></span>
<span id="cb134-13"><a href="#cb134-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_ribbon</span>(<span class="fu">aes</span>(<span class="at">ymin =</span> sarima_lower, <span class="at">ymax =</span> sarima_upper), <span class="at">fill =</span> <span class="st">"blue"</span>, <span class="at">alpha =</span> <span class="fl">0.2</span>, <span class="at">na.rm =</span> <span class="cn">TRUE</span>) <span class="sc">+</span></span>
<span id="cb134-14"><a href="#cb134-14" aria-hidden="true" tabindex="-1"></a>  <span class="co"># ARIMAX model</span></span>
<span id="cb134-15"><a href="#cb134-15" aria-hidden="true" tabindex="-1"></a>  <span class="co">#geom_line(aes(y = arimax_pred), color = "green", size = 1, na.rm = TRUE) +</span></span>
<span id="cb134-16"><a href="#cb134-16" aria-hidden="true" tabindex="-1"></a>  <span class="co">#geom_point(aes(y = arimax_pred), color = "green", size = 1.2, na.rm = TRUE) +</span></span>
<span id="cb134-17"><a href="#cb134-17" aria-hidden="true" tabindex="-1"></a>  <span class="co">#geom_ribbon(aes(ymin = arimax_lower, ymax = arimax_upper), fill = "green", alpha = 0.2, na.rm = TRUE) +</span></span>
<span id="cb134-18"><a href="#cb134-18" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Vertikální čára oddělující historii od predikcí</span></span>
<span id="cb134-19"><a href="#cb134-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_vline</span>(<span class="at">xintercept =</span> <span class="fu">max</span>(historical_dates), <span class="at">linetype =</span> <span class="st">"dashed"</span>, <span class="at">alpha =</span> <span class="fl">0.7</span>, <span class="at">color =</span> <span class="st">"gray50"</span>, <span class="at">size =</span> <span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb134-20"><a href="#cb134-20" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Lepší popisky a téma</span></span>
<span id="cb134-21"><a href="#cb134-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Predikce týdenních nových případů - srovnání modelů"</span>, <span class="at">x =</span> <span class="st">"Datum"</span>, <span class="at">y =</span> <span class="st">"Počet případů (týdně)"</span>,</span>
<span id="cb134-22"><a href="#cb134-22" aria-hidden="true" tabindex="-1"></a>       <span class="at">subtitle =</span> <span class="fu">paste</span>(<span class="st">"Historická data (černá) | Predikce: Funkční (červená), SARIMA (modrá)"</span>, <span class="st">"</span><span class="sc">\n</span><span class="st">Přerušovaná čára označuje konec historických dat"</span>)) <span class="sc">+</span></span>
<span id="cb134-23"><a href="#cb134-23" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb134-24"><a href="#cb134-24" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">"none"</span>, <span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">14</span>, <span class="at">hjust =</span> <span class="fl">0.5</span>, <span class="at">face =</span> <span class="st">"bold"</span>), <span class="at">plot.subtitle =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">11</span>, <span class="at">hjust =</span> <span class="fl">0.5</span>),</span>
<span id="cb134-25"><a href="#cb134-25" aria-hidden="true" tabindex="-1"></a>    <span class="at">axis.text.x =</span> <span class="fu">element_text</span>(<span class="at">angle =</span> <span class="dv">45</span>, <span class="at">hjust =</span> <span class="dv">1</span>), <span class="at">panel.grid.minor =</span> <span class="fu">element_blank</span>())</span>
<span id="cb134-26"><a href="#cb134-26" aria-hidden="true" tabindex="-1"></a><span class="co">#  # Rozumné limity osy y</span></span>
<span id="cb134-27"><a href="#cb134-27" aria-hidden="true" tabindex="-1"></a><span class="co">#  + coord_cartesian(ylim = c(0, max(c(historical_values, #pred_func_clean, pred_sarima, pred_arimax_clean), na.rm = TRUE) * #1.1))</span></span>
<span id="cb134-28"><a href="#cb134-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb134-29"><a href="#cb134-29" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(prediction_plot <span class="sc">+</span> <span class="fu">ylim</span>(<span class="dv">0</span>, <span class="dv">2000000</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="covid_data_analyse_files/figure-html/unnamed-chunk-17-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" width="6000"></p>
</figure>
</div>
</div>
<div class="sourceCode cell-code" id="cb135"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb135-1"><a href="#cb135-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Číselný souhrn predikcí</span></span>
<span id="cb135-2"><a href="#cb135-2" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"</span><span class="sc">\n</span><span class="st">=== ČÍSELNÉ PREDIKCE (měsíční hodnoty) ===</span><span class="sc">\n</span><span class="st">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
=== ČÍSELNÉ PREDIKCE (měsíční hodnoty) ===</code></pre>
</div>
<div class="sourceCode cell-code" id="cb137"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb137-1"><a href="#cb137-1" aria-hidden="true" tabindex="-1"></a>predictions_summary <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(Měsíc <span class="ot">=</span> future_dates, Funkční <span class="ot">=</span> <span class="fu">round</span>(pred_func_clean, <span class="dv">0</span>), <span class="at">SARIMA =</span> <span class="fu">round</span>(pred_sarima_clean, <span class="dv">0</span>), <span class="at">ARIMAX =</span> <span class="fu">round</span>(pred_arimax_clean, <span class="dv">0</span>))</span>
<span id="cb137-2"><a href="#cb137-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb137-3"><a href="#cb137-3" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(<span class="st">"Predikce na příštích 10 měsíců:"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "Predikce na příštích 10 měsíců:"</code></pre>
</div>
<div class="sourceCode cell-code" id="cb139"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb139-1"><a href="#cb139-1" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(predictions_summary)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>        Měsíc Funkční SARIMA  ARIMAX
1  2024-08-11   32825 211838 5401180
2  2024-08-18   29324 193294 5423954
3  2024-08-25   26129 194763 5817708
4  2024-09-01   23225 203837 6116011
5  2024-09-08   20596 209266 6086557
6  2024-09-15   18224 219676 5768257
7  2024-09-22   16093 221152 5331853
8  2024-09-29   14185 222160 4917604
9  2024-10-06   12482 221498 4582099
10 2024-10-13   10968 220466 4321477</code></pre>
</div>
</div>
<p>V tomto modelu nejsou vidět všechny, protože jsou vykresleny na stejném místě.</p>
</section>
</section>
<section id="závěrečné-srovnání-a-doporučení" class="level2">
<h2 class="anchored" data-anchor-id="závěrečné-srovnání-a-doporučení">Závěrečné srovnání a doporučení</h2>
<p>Zhodnocení všech testovaných přístupů a formulace doporučení pro praxi.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb141"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb141-1"><a href="#cb141-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Finální srovnání všech modelů</span></span>
<span id="cb141-2"><a href="#cb141-2" aria-hidden="true" tabindex="-1"></a>final_comparison <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(</span>
<span id="cb141-3"><a href="#cb141-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">Model =</span> <span class="fu">c</span>(<span class="st">"Funkční (trend+sezónost)"</span>, <span class="st">"SARIMA"</span>, <span class="st">"ARIMAX"</span>),</span>
<span id="cb141-4"><a href="#cb141-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">AIC =</span> <span class="fu">c</span>(<span class="fu">AIC</span>(best_func_model), <span class="fu">AIC</span>(final_sarima), <span class="fu">AIC</span>(arimax_model)),</span>
<span id="cb141-5"><a href="#cb141-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">BIC =</span> <span class="fu">c</span>(<span class="fu">BIC</span>(best_func_model), <span class="fu">BIC</span>(final_sarima), <span class="fu">BIC</span>(arimax_model)),</span>
<span id="cb141-6"><a href="#cb141-6" aria-hidden="true" tabindex="-1"></a>  Parametrů <span class="ot">=</span> <span class="fu">c</span>(<span class="fu">length</span>(<span class="fu">coef</span>(best_func_model)), </span>
<span id="cb141-7"><a href="#cb141-7" aria-hidden="true" tabindex="-1"></a>                <span class="fu">length</span>(<span class="fu">coef</span>(final_sarima)),</span>
<span id="cb141-8"><a href="#cb141-8" aria-hidden="true" tabindex="-1"></a>                <span class="fu">length</span>(<span class="fu">coef</span>(arimax_model))),</span>
<span id="cb141-9"><a href="#cb141-9" aria-hidden="true" tabindex="-1"></a>  <span class="at">RMSE =</span> <span class="fu">c</span>(</span>
<span id="cb141-10"><a href="#cb141-10" aria-hidden="true" tabindex="-1"></a>    <span class="fu">sqrt</span>(<span class="fu">mean</span>(<span class="fu">residuals</span>(best_func_model)<span class="sc">^</span><span class="dv">2</span>)),</span>
<span id="cb141-11"><a href="#cb141-11" aria-hidden="true" tabindex="-1"></a>    <span class="fu">sqrt</span>(<span class="fu">mean</span>(<span class="fu">residuals</span>(final_sarima)<span class="sc">^</span><span class="dv">2</span>)),</span>
<span id="cb141-12"><a href="#cb141-12" aria-hidden="true" tabindex="-1"></a>    <span class="fu">sqrt</span>(<span class="fu">mean</span>(<span class="fu">residuals</span>(arimax_model)<span class="sc">^</span><span class="dv">2</span>))</span>
<span id="cb141-13"><a href="#cb141-13" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb141-14"><a href="#cb141-14" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb141-15"><a href="#cb141-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb141-16"><a href="#cb141-16" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(<span class="st">"Finální srovnání modelů:"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "Finální srovnání modelů:"</code></pre>
</div>
<div class="sourceCode cell-code" id="cb143"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb143-1"><a href="#cb143-1" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(final_comparison)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>                     Model       AIC       BIC Parametrů      RMSE
1 Funkční (trend+sezónost)  796.9181  817.8019         5 1.2414840
2                   SARIMA  194.4800  218.7859         6 0.3509056
3                   ARIMAX -124.3671 -103.2461         6 0.1510578</code></pre>
</div>
</div>
<p>ARIMAX vyšel jako statisticky nejlepší. SARIMA je dobrý kompromis. Funkční je nejhorší fit. ale interpretovatelná.</p>
<p><strong>Cross-korelační analýza - klíčové zjištění:</strong></p>
<ul>
<li>new_deaths vs new_cases - Silná pozitivní korelace s lag -1 až +1 → Úmrtí následují případy s krátkou prodlevou.</li>
</ul>
<!-- -->
<ul>
<li>hosp_patients - Dobrý prediktor na lag 0 a +1 → Hospitalizace korelují s trendy a budoucími případy.</li>
</ul>
<!-- -->
<ul>
<li>stringency_index - Slabá negativní korelace → Vládní opatření mají omezený okamžitý účinek.</li>
</ul>
<p><strong>Shrnutí predikcí (transformováno z log-škály):</strong></p>
<p>Všechny tři modely predikují pokles nebo stabilizaci nových případů.</p>
<ul>
<li><p>Funkční model - ~20 000 případů týdně (pravděpodobně podhodnoceno)</p></li>
<li><p>SARIMA: ~200 000 případů týdně (konzervativní odhad)</p></li>
<li><p>ARIMAX: ~5 000 000 případů týdně (nejvyšší, zahrnuje externí faktory)</p></li>
</ul>
<p><strong>Hlavní problémy s predikcí:</strong></p>
<ul>
<li><p>Extrapolace externích proměnných - ARIMAX model předpokládá konstantní hodnoty hospitalizací, mortality a přísnosti opatření.</p></li>
<li><p>Strukturální změny - COVID-19 data obsahují strukturální zlomy (nové varianty, vakcinace), které modely nezachycují.</p></li>
<li><p>Krátký horizont - 10 období vpřed je rozumné, ale nejistota rychle roste.</p></li>
<li><p>Sezónní predikce - Model předpokládá pokračování historických sezónních vzorců.</p></li>
</ul>
</section>
<section id="závěr" class="level2">
<h2 class="anchored" data-anchor-id="závěr">Závěr</h2>
<p><strong>Hlavní závěry analýzy:</strong></p>
<ul>
<li><p>Metodická kvalita - Analýza používá správné statistické metody a postupuje systematicky od EDA k predikci.</p></li>
<li><p>Model selection - ARIMAX model dosahuje nejlepší statistické výsledky (AIC = -124.4), ale jeho praktická použitelnost je omezena.</p></li>
<li><p>Sezónnost - Data vykazují jasné sezónní vzorce s vyšší incidencí v zimních měsících.</p></li>
<li><p>Externí faktory - Hospitalizace jsou nejsilnějším prediktorem budoucích případů.</p></li>
</ul>
<p><strong>Doporučení pro praxi:</strong></p>
<ul>
<li><p>Krátkodobé predikce (1-4 týdny) - ARIMAX model s aktualizovanými externími proměnnými.</p></li>
<li><p>Střednědobé (1-3 měsíce) - SARIMA model jako robustní baseline.</p></li>
<li><p>Dlouhodobé (3+ měsíce) - Kombinace modelů s expertním posouzením.</p></li>
<li><p>Monitoring - Pravidelná rekalibrce modelů při změnách v epidemiologické situaci.</p></li>
</ul>
<p><strong>Omezení a doporučení pro zlepšení:</strong></p>
<ul>
<li><p>Regimní změny - Implementovat modely s strukturálními zlomy (např. bcp, changepoint).</p></li>
<li><p>Více externích dat - Zahrnout vakcinační pokrytí, mobilitu obyvatelstva, meteorologická data.</p></li>
<li><p>Ensemble metody - Kombinovat predikce více modelů pro robustnost.</p></li>
<li><p>Pravděpodobnostní predikce - Větší důraz na predikční intervaly než bodové odhady.</p></li>
<li><p>Validace - Out-of-sample testování na držených datech.</p></li>
</ul>
<p><strong>Celkové hodnocení:</strong></p>
<p>Analýza představuje solidní ukázku aplikace časových řad na epidemiologická data. Metodika je správná, postupy jsou transparentní a výsledky jsou interpretovatelné. Hlavní síla leží v systematickém srovnání různých přístupů a důkladné diagnostice modelů.</p>
<p>Praktická hodnota - Výsledky lze použít pro krátkodobé plánování kapacit zdravotnictví, ale s opatrností a pravidelnou aktualizací při změnách v epidemiologické situaci.</p>
</section>
</section>

</main>
<!-- /main column -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const onCopySuccess = function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  }
  const getTextToCopy = function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
    text: getTextToCopy
  });
  clipboard.on('success', onCopySuccess);
  if (window.document.getElementById('quarto-embedded-source-code-modal')) {
    // For code content inside modals, clipBoardJS needs to be initialized with a container option
    // TODO: Check when it could be a function (https://github.com/zenorocha/clipboard.js/issues/860)
    const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
      text: getTextToCopy,
      container: window.document.getElementById('quarto-embedded-source-code-modal')
    });
    clipboardModal.on('success', onCopySuccess);
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp('/' + window.location.host + '/');
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->




</body></html>